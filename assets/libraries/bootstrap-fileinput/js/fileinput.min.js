/*!
 * @copyright Copyright &copy; Kartik Visweswaran, Krajee.com, 2014 - 2015
 * @version 4.1.9
 *
 * File input styled for Bootstrap 3.0 that utilizes HTML5 File Input's advanced
 * features including the FileReader API.
 *
 * The plugin drastically enhances the HTML file input to preview multiple files on the client before
 * upload. In addition it provides the ability to preview content of images, text, videos, audio, html,
 * flash and other objects. It also offers the ability to upload and delete files using AJAX, and add
 * files in batches (i.e. preview, append, or remove before upload).
 *
 * Author: Kartik Visweswaran
 * Copyright: 2015, Kartik Visweswaran, Krajee.com
 * For more JQuery plugins visit http://plugins.krajee.com
 * For more Yii related demos visit http://demos.krajee.com
 */
!function(aH){String.prototype.repl=function(b,a){return this.split(b).join(a)};var aD=function(c){var b,a=document.createElement("div");return a.innerHTML="<!--[if IE "+c+"]><i></i><![endif]-->",b=1===a.getElementsByTagName("i").length,document.body.appendChild(a),a.parentNode.removeChild(a),b},ar={data:{},init:function(d){var c=d.initialPreview,b=d.id;c.length>0&&!al(c)&&(c=c.split(d.initialPreviewDelimiter)),ar.data[b]={content:c,config:d.initialPreviewConfig,tags:d.initialPreviewThumbTags,delimiter:d.initialPreviewDelimiter,template:d.previewGenericTemplate,msg:function(a){return d.getMsgSelected(a)},initId:d.previewInitId,footer:d.getLayoutTemplate("footer"),isDelete:d.initialPreviewShowDelete,caption:d.initialCaption,actions:function(g,f,e,j,h){return d.renderFileActions(g,f,e,j,h)}}},fetch:function(a){return ar.data[a].content.filter(function(b){return null!==b})},count:function(b,a){return ar.data[b]&&ar.data[b].content?a?ar.data[b].content.length:ar.fetch(b).length:0},get:function(g,d,c){var j,f="init_"+d,b=ar.data[g],h=b.initId+"-"+f;return c=void 0===c?!0:c,null===b.content[d]?"":(j=b.template.repl("{previewId}",h).repl("{frameClass}"," file-preview-initial").repl("{fileindex}",f).repl("{content}",b.content[d]).repl("{footer}",ar.footer(g,d,c)),b.tags.length&&b.tags[d]&&(j=aM(j,b.tags[d])),j)},add:function(d,c,h,f,b){var g,e=aH.extend(!0,{},ar.data[d]);return al(c)||(c=c.split(e.delimiter)),b?(g=e.content.push(c)-1,e.config[g]=h,e.tags[g]=f):(g=c.length,e.content=c,e.config=h,e.tags=f),ar.data[d]=e,g},set:function(d,c,h,f,b){var g,e=aH.extend(!0,{},ar.data[d]);if(al(c)||(c=c.split(e.delimiter)),b){for(g=0;g<c.length;g++){e.content.push(c[g])}for(g=0;g<h.length;g++){e.config.push(h[g])}for(g=0;g<f.length;g++){e.tags.push(f[g])}}else{e.content=c,e.config=h,e.tags=f}ar.data[d]=e},unset:function(d,c){var b=ar.count(d);if(b){if(1===b){return ar.data[d].content=[],void (ar.data[d].config=[])}ar.data[d].content[c]=null,ar.data[d].config[c]=null}},out:function(g){var d,c="",h=ar.data[g],f=ar.count(g,!0);if(0===f){return{content:"",caption:""}}for(var b=0;f>b;b++){c+=ar.get(g,b)}return d=h.msg(ar.count(g)),{content:c,caption:d}},footer:function(m,k,v){var h=ar.data[m];if(v=void 0===v?!0:v,0===h.config.length||V(h.config[k])){return""}var b=h.config[k],j=aa("caption",b)?b.caption:"",g=aa("width",b)?b.width:"auto",x=aa("url",b)?b.url:!1,q=aa("key",b)?b.key:null,t=x===!1&&v,f=h.isDelete?h.actions(!1,!0,t,x,q):"",w=h.footer.repl("{actions}",f);return w.repl("{caption}",j).repl("{width}",g).repl("{indicator}","").repl("{indicatorTitle}","")}},aL=function(b,a){return a=a||0,"number"==typeof b?b:("string"==typeof b&&(b=parseFloat(b)),isNaN(b)?a:b)},ay=function(){return window.File&&window.FileReader},au=function(){var a=document.createElement("div");return !aD(9)&&(void 0!==a.draggable||void 0!==a.ondragstart&&void 0!==a.ondrop)},aA=function(){return ay&&window.FormData},ax=function(b,a){b.removeClass(a).addClass(a)},at='style="width:{width};height:{height};"',aI='      <param name="controller" value="true" />\n      <param name="allowFullScreen" value="true" />\n      <param name="allowScriptAccess" value="always" />\n      <param name="autoPlay" value="false" />\n      <param name="autoStart" value="false" />\n      <param name="quality" value="high" />\n',aJ='<div class="file-preview-other">\n       {previewFileIcon}\n   </div>',aw={removeIcon:'<i class="glyphicon glyphicon-trash text-danger"></i>',removeClass:"btn btn-xs btn-default",removeTitle:"Remove file",uploadIcon:'<i class="glyphicon glyphicon-upload text-info"></i>',uploadClass:"btn btn-xs btn-default",uploadTitle:"Upload file",indicatorNew:'<i class="glyphicon glyphicon-hand-down text-warning"></i>',indicatorSuccess:'<i class="glyphicon glyphicon-ok-sign file-icon-large text-success"></i>',indicatorError:'<i class="glyphicon glyphicon-exclamation-sign text-danger"></i>',indicatorLoading:'<i class="glyphicon glyphicon-hand-up text-muted"></i>',indicatorNewTitle:"Not uploaded yet",indicatorSuccessTitle:"Uploaded",indicatorErrorTitle:"Upload Error",indicatorLoadingTitle:"Uploading ..."},aq='{preview}\n<div class="kv-upload-progress hide"></div>\n<div class="input-group {class}">\n   {caption}\n   <div class="input-group-btn">\n       {remove}\n       {cancel}\n       {upload}\n       {browse}\n   </div>\n</div>',aG='{preview}\n<div class="kv-upload-progress hide"></div>\n{remove}\n{cancel}\n{upload}\n{browse}\n',ap='<div class="file-preview {class}">\n    <div class="close fileinput-remove">&times;</div>\n    <div class="{dropClass}">\n    <div class="file-preview-thumbnails">\n    </div>\n    <div class="clearfix"></div>    <div class="file-preview-status text-center text-success"></div>\n    <div class="kv-fileinput-error"></div>\n    </div>\n</div>',aE='<span class="glyphicon glyphicon-file kv-caption-icon"></span>',az='<div tabindex="-1" class="form-control file-caption {class}">\n   <span class="file-caption-ellipsis">&hellip;</span>\n   <div class="file-caption-name"></div>\n</div>',aF='<div id="{id}" class="modal fade">\n  <div class="modal-dialog modal-lg">\n    <div class="modal-content">\n      <div class="modal-header">\n        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>\n        <h3 class="modal-title">Detailed Preview <small>{title}</small></h3>\n      </div>\n      <div class="modal-body">\n        <textarea class="form-control" style="font-family:Monaco,Consolas,monospace; height: {height}px;" readonly>{body}</textarea>\n      </div>\n    </div>\n  </div>\n</div>',ao='<div class="progress">\n    <div class="{class}" role="progressbar" aria-valuenow="{percent}" aria-valuemin="0" aria-valuemax="100" style="width:{percent}%;">\n        {percent}%\n     </div>\n</div>',aK='<div class="file-thumbnail-footer">\n    <div class="file-caption-name">{caption}</div>\n    {actions}\n</div>',an='<div class="file-actions">\n    <div class="file-footer-buttons">\n        {upload}{delete}{other}    </div>\n    <div class="file-upload-indicator" tabindex="-1" title="{indicatorTitle}">{indicator}</div>\n    <div class="clearfix"></div>\n</div>',ah='<button type="button" class="kv-file-remove {removeClass}" title="{removeTitle}"{dataUrl}{dataKey}>{removeIcon}</button>\n',am='<button type="button" class="kv-file-upload {uploadClass}" title="{uploadTitle}">   {uploadIcon}\n</button>\n',K='<div class="file-preview-frame{frameClass}" id="{previewId}" data-fileindex="{fileindex}">\n   {content}\n   {footer}\n</div>\n',af='<div class="file-preview-frame{frameClass}" id="{previewId}" data-fileindex="{fileindex}">\n    <object data="{data}" type="{type}" width="{width}" height="{height}">\n       '+aJ+"\n    </object>\n   {footer}\n</div>",ae='<div class="file-preview-frame{frameClass}" id="{previewId}" data-fileindex="{fileindex}">\n   <img src="{data}" class="file-preview-image" title="{caption}" alt="{caption}" '+at+">\n   {footer}\n</div>\n",aB='<div class="file-preview-frame{frameClass}" id="{previewId}" data-fileindex="{fileindex}">\n   <div class="file-preview-text" title="{caption}" '+at+">\n       {data}\n   </div>\n   {footer}\n</div>",ak='<div class="file-preview-frame{frameClass}" id="{previewId}" data-fileindex="{fileindex}" title="{caption}" '+at+'>\n   <video width="{width}" height="{height}" controls>\n       <source src="{data}" type="{type}">\n       '+aJ+"\n   </video>\n   {footer}\n</div>\n",ac='<div class="file-preview-frame{frameClass}" id="{previewId}" data-fileindex="{fileindex}" title="{caption}" '+at+'>\n   <audio controls>\n       <source src="{data}" type="{type}">\n       '+aJ+"\n   </audio>\n   {footer}\n</div>",ag='<div class="file-preview-frame{frameClass}" id="{previewId}" data-fileindex="{fileindex}" title="{caption}" '+at+'>\n   <object type="application/x-shockwave-flash" width="{width}" height="{height}" data="{data}">\n'+aI+"       "+aJ+"\n   </object>\n   {footer}\n</div>\n",W='<div class="file-preview-frame{frameClass}" id="{previewId}" data-fileindex="{fileindex}" title="{caption}" '+at+'>\n   <object data="{data}" type="{type}" width="{width}" height="{height}">\n       <param name="movie" value="{caption}" />\n'+aI+"         "+aJ+"\n   </object>\n   {footer}\n</div>",Q='<div class="file-preview-frame{frameClass}" id="{previewId}" data-fileindex="{fileindex}" title="{caption}" '+at+">\n   "+aJ+"\n   {footer}\n</div>",J={main1:aq,main2:aG,preview:ap,icon:aE,caption:az,modal:aF,progress:ao,footer:aK,actions:an,actionDelete:ah,actionUpload:am},aC={generic:K,html:af,image:ae,text:aB,video:ak,audio:ac,flash:ag,object:W,other:Q},aj=["image","html","text","video","audio","flash","object"],ab={image:{width:"auto",height:"160px"},html:{width:"213px",height:"160px"},text:{width:"160px",height:"160px"},video:{width:"213px",height:"160px"},audio:{width:"213px",height:"80px"},flash:{width:"213px",height:"160px"},object:{width:"160px",height:"160px"},other:{width:"160px",height:"160px"}},X={image:function(b,a){return void 0!==b?b.match("image.*"):a.match(/\.(gif|png|jpe?g)$/i)},html:function(b,a){return void 0!==b?"text/html"===b:a.match(/\.(htm|html)$/i)},text:function(b,a){return void 0!==b&&b.match("text.*")||a.match(/\.(txt|md|csv|nfo|php|ini)$/i)},video:function(b,a){return void 0!==b&&b.match(/\.video\/(ogg|mp4|webm)$/i)||a.match(/\.(og?|mp4|webm)$/i)},audio:function(b,a){return void 0!==b&&b.match(/\.audio\/(ogg|mp3|wav)$/i)||a.match(/\.(ogg|mp3|wav)$/i)},flash:function(b,a){return void 0!==b&&"application/x-shockwave-flash"===b||a.match(/\.(swf)$/i)},object:function(){return !0},other:function(){return !0}},V=function(b,a){return null===b||void 0===b||0===b.length||a&&""===aH.trim(b)},al=function(a){return Array.isArray(a)||"[object Array]"===Object.prototype.toString.call(a)},aa=function(b,a){return"object"==typeof a&&b in a},ai=function(d,c,b){return V(d)||V(d[c])?b:aH(d[c])},Y=function(){return Math.round((new Date).getTime()+100*Math.random())},G=function(a){return String(a).repl("&","&amp;").repl('"',"&quot;").repl("'","&#39;").repl("<","&lt;").repl(">","&gt;")},aM=function(d,c){var b=d;return c=c||{},aH.each(c,function(f,a){"function"==typeof a&&(a=a()),b=b.repl(f,a)}),b},av=window.URL||window.webkitURL,ad=function(c,b){var d=this;d.$element=aH(c),d.validate()&&(ay()||aD(9)?(d.init(b),d.listen()):d.$element.removeClass("file-loading"))};ad.prototype={constructor:ad,validate:function(){var b,a=this;return"file"===a.$element.attr("type")?!0:(b='<div class="help-block alert alert-warning"><h4>Invalid Input Type</h4>You must set an input <code>type = file</code> for <b>bootstrap-fileinput</b> plugin to initialize.</div>',a.$element.after(b),!1)},init:function(f){var a,b=this,e=b.$element;aH.each(f,function(d,c){b[d]="maxFileCount"===d||"maxFileSize"===d?aL(c):c}),b.fileInputCleared=!1,b.fileBatchCompleted=!0,V(b.allowedPreviewTypes)&&(b.allowedPreviewTypes=aj),b.uploadFileAttr=V(e.attr("name"))?"file_data":e.attr("name"),b.reader=null,b.formdata={},b.isIE9=aD(9),b.isIE10=aD(10),b.filestack=[],b.ajaxRequests=[],b.isError=!1,b.ajaxAborted=!1,b.dropZoneEnabled=au()&&b.dropZoneEnabled,b.isDisabled=b.$element.attr("disabled")||b.$element.attr("readonly"),b.isUploadable=aA&&!V(b.uploadUrl),b.slug="function"==typeof f.slugCallback?f.slugCallback:b.slugDefault,b.mainTemplate=b.getLayoutTemplate(b.showCaption?"main1":"main2"),b.captionTemplate=b.getLayoutTemplate("caption"),b.previewGenericTemplate=b.getPreviewTemplate("generic"),V(b.$element.attr("id"))&&b.$element.attr("id",Y()),void 0===b.$container?b.$container=b.createContainer():b.refreshContainer(),b.$progress=b.$container.find(".kv-upload-progress"),b.$btnUpload=b.$container.find(".kv-fileinput-upload"),b.$captionContainer=ai(f,"elCaptionContainer",b.$container.find(".file-caption")),b.$caption=ai(f,"elCaptionText",b.$container.find(".file-caption-name")),b.$previewContainer=ai(f,"elPreviewContainer",b.$container.find(".file-preview")),b.$preview=ai(f,"elPreviewImage",b.$container.find(".file-preview-thumbnails")),b.$previewStatus=ai(f,"elPreviewStatus",b.$container.find(".file-preview-status")),b.$errorContainer=ai(f,"elErrorContainer",b.$previewContainer.find(".kv-fileinput-error")),V(b.msgErrorClass)||ax(b.$errorContainer,b.msgErrorClass),b.$errorContainer.hide(),b.fileActionSettings=aH.extend(aw,f.fileActionSettings),b.previewInitId="preview-"+Y(),b.id=b.$element.attr("id"),ar.init(b),b.initPreview(!0),b.initPreviewDeletes(),b.options=f,b.setFileDropZoneTitle(),b.uploadCount=0,b.uploadPercent=0,b.$element.removeClass("file-loading"),a=b.getLayoutTemplate("progress"),b.progressTemplate=a.replace("{class}",b.progressClass),b.progressCompleteTemplate=a.replace("{class}",b.progressCompleteClass),b.setEllipsis()},parseError:function(e,d,c){var h=this,f=aH.trim(d+""),b="."===f.slice(-1)?"":".",g=aH(e.responseText).text();return h.showAjaxErrorDetails?(g=aH.trim(g.replace(/\n\s*\n/g,"\n")),g=g.length>0?"<pre>"+g+"</pre>":"",f+=b+g):f+=b,c?"<b>"+c+": </b>"+e:f},raise:function(d,c){var b=this,f=aH.Event(d),e=!1;if(void 0!==c?b.$element.trigger(f,c):b.$element.trigger(f),f.result&&(e=!0),e){switch(d){case"filebatchuploadcomplete":case"filebatchuploadsuccess":case"fileuploaded":case"fileclear":case"filecleared":case"filereset":case"fileerror":case"filefoldererror":case"fileuploaderror":case"filebatchuploaderror":case"filedeleteerror":case"filecustomerror":break;default:b.ajaxAborted=e}}},getLayoutTemplate:function(c){var b=this,a=aa(c,b.layoutTemplates)?b.layoutTemplates[c]:J[c];return V(b.customLayoutTags)?a:aM(a,b.customLayoutTags)},getPreviewTemplate:function(c){var b=this,a=aa(c,b.previewTemplates)?b.previewTemplates[c]:aC[c];return a=a.repl("{previewFileIcon}",b.previewFileIcon),V(b.customPreviewTags)?a:aM(a,b.customPreviewTags)},getOutData:function(f,d,c){var b=this;return f=f||{},d=d||{},c=c||b.filestack.slice(0)||{},{form:b.formdata,files:c,extra:b.getExtraData(),response:d,reader:b.reader,jqXHR:f}},setEllipsis:function(){var f=this,d=f.$captionContainer,c=f.$caption,b=c.clone().css("height","auto").hide();d.parent().before(b),d.removeClass("kv-has-ellipsis"),b.outerWidth()>c.outerWidth()&&d.addClass("kv-has-ellipsis"),b.remove()},listen:function(){var d=this,c=d.$element,b=d.$captionContainer,f=d.$btnFile,e=c.closest("form");c.on("change",aH.proxy(d.change,d)),aH(window).on("resize",function(){d.setEllipsis()}),f.off("click").on("click",function(){d.raise("filebrowse"),d.isError&&!d.isUploadable&&d.clear(),b.focus()}),e.off("reset").on("reset",aH.proxy(d.reset,d)),d.$container.off("click").on("click",".fileinput-remove:not([disabled])",aH.proxy(d.clear,d)).on("click",".fileinput-cancel",aH.proxy(d.cancel,d)),d.isUploadable&&d.dropZoneEnabled&&d.showPreview&&d.initDragDrop(),d.isUploadable||e.on("submit",aH.proxy(d.submitForm,d)),d.$container.find(".kv-fileinput-upload").off("click").on("click",function(a){d.isUploadable&&(a.preventDefault(),!aH(this).hasClass("disabled")&&V(aH(this).attr("disabled"))&&d.upload())})},submitForm:function(){var c=this,b=c.$element,a=b.get(0).files;return a&&a.length<c.minFileCount&&c.minFileCount>0?(c.noFilesError({}),!1):!c.abort({})},abort:function(d){var c,b=this;return b.ajaxAborted&&"object"==typeof b.ajaxAborted&&void 0!==b.ajaxAborted.message?(c=void 0!==b.ajaxAborted.data?b.getOutData({},b.ajaxAborted.data):b.getOutData(),c=aH.extend(c,d),b.showUploadError(b.ajaxAborted.message,c,"filecustomerror"),!0):!1},noFilesError:function(f){var d=this,c=d.minFileCount>1?d.filePlural:d.fileSingle,b=d.msgFilesTooLess.repl("{n}",d.minFileCount).repl("{files}",c),g=d.$errorContainer;g.html(b),d.isError=!0,d.updateFileDetails(0),g.fadeIn(800),d.raise("fileerror",[f]),d.clearFileInput(),ax(d.$container,"has-error")},setProgress:function(f){var d=this,c=Math.min(f,100),b=100>c?d.progressTemplate:d.progressCompleteTemplate;d.$progress.html(b.repl("{percent}",c))},upload:function(){var e,d,c,h=this,f=h.getFileStack().length,b={},g=!aH.isEmptyObject(h.getExtraData());if(f<h.minFileCount&&h.minFileCount>0){return void h.noFilesError(b)}if(h.isUploadable&&!h.isDisabled&&(0!==f||g)){if(h.resetUpload(),h.$progress.removeClass("hide"),h.uploadCount=0,h.uploadPercent=0,h.lock(),h.setProgress(0),0===f&&g){return void h.uploadExtraOnly()}if(c=h.filestack.length,h.hasInitData=!1,h.uploadAsync&&h.showPreview){for(d=h.getOutData(),h.raise("filebatchpreupload",[d]),h.fileBatchCompleted=!1,h.uploadCache={content:[],config:[],tags:[],append:!0},e=0;c>e;e+=1){void 0!==h.filestack[e]&&h.uploadSingle(e,h.filestack,!0)}}else{h.uploadBatch()}}},lock:function(){var a=this;a.resetErrors(),a.disable(),a.showRemove&&ax(a.$container.find(".fileinput-remove"),"hide"),a.showCancel&&a.$container.find(".fileinput-cancel").removeClass("hide"),a.raise("filelock",[a.filestack,a.getExtraData()])},unlock:function(b){var a=this;void 0===b&&(b=!0),a.enable(),a.showCancel&&ax(a.$container.find(".fileinput-cancel"),"hide"),a.showRemove&&a.$container.find(".fileinput-remove").removeClass("hide"),b&&a.resetFileStack(),a.raise("fileunlock",[a.filestack,a.getExtraData()])},resetFileStack:function(){var d=this,c=0,b=[];d.getThumbs().each(function(){var f=aH(this),e=f.attr("data-fileindex"),a=d.filestack[e];-1!==e&&(void 0!==a?(b[c]=a,f.attr({id:d.previewInitId+"-"+c,"data-fileindex":c}),c+=1):f.attr({id:"uploaded-"+Y(),"data-fileindex":"-1"}))}),d.filestack=b},refresh:function(d){var c,b=this,f=b.$element,e=arguments.length?aH.extend(b.options,d):b.options;f.off(),b.init(e),c=b.$container.find(".file-drop-zone"),c.off("dragenter dragover drop"),aH(document).off("dragenter dragover drop"),b.listen(),b.setFileDropZoneTitle()},initDragDrop:function(){var b=this,a=b.$container.find(".file-drop-zone");a.off("dragenter dragover drop"),aH(document).off("dragenter dragover drop"),a.on("dragenter dragover",function(c){c.stopPropagation(),c.preventDefault(),b.isDisabled||ax(aH(this),"highlighted")}),a.on("dragleave",function(c){c.stopPropagation(),c.preventDefault(),b.isDisabled||aH(this).removeClass("highlighted")}),a.on("drop",function(c){c.preventDefault(),b.isDisabled||(b.change(c,"dragdrop"),aH(this).removeClass("highlighted"))}),aH(document).on("dragenter dragover drop",function(c){c.stopPropagation(),c.preventDefault()})},setFileDropZoneTitle:function(){var b=this,a=b.$container.find(".file-drop-zone");a.find("."+b.dropZoneTitleClass).remove(),b.isUploadable&&b.showPreview&&0!==a.length&&!(b.getFileStack().length>0)&&b.dropZoneEnabled&&(0===a.find(".file-preview-frame").length&&a.prepend('<div class="'+b.dropZoneTitleClass+'">'+b.dropZoneTitle+"</div>"),b.$container.removeClass("file-input-new"),ax(b.$container,"file-input-ajax-new"))},initFileActions:function(){var a=this;a.$preview.find(".kv-file-remove").each(function(){var c,f,d=aH(this),b=d.closest(".file-preview-frame"),e=b.attr("data-fileindex");d.off("click").on("click",function(){b.fadeOut("slow",function(){a.filestack[e]=void 0,a.clearObjects(b),b.remove();var i=a.getFileStack(),h=i.length,g=ar.count(a.id);a.clearFileInput(),0===h&&0===g?a.reset():(c=g+h,f=c>1?a.getMsgSelected(c):i[0].name,a.setCaption(f))})})}),a.$preview.find(".kv-file-upload").each(function(){var b=aH(this);b.off("click").on("click",function(){var d=b.closest(".file-preview-frame"),c=d.attr("data-fileindex");a.uploadSingle(c,a.filestack,!1)})})},getMsgSelected:function(c){var b=this,a=1===c?b.fileSingle:b.filePlural;return b.msgSelected.repl("{n}",c).repl("{files}",a)},renderFileFooter:function(h,f){var d,c,j=this,g=j.fileActionSettings,b=j.getLayoutTemplate("footer");return j.isUploadable?(d=b.repl("{actions}",j.renderFileActions(!0,!0,!1,!1,!1)),c=d.repl("{caption}",h).repl("{width}",f).repl("{indicator}",g.indicatorNew).repl("{indicatorTitle}",g.indicatorNewTitle)):c=b.repl("{actions}","").repl("{caption}",h).repl("{width}",f).repl("{indicator}","").repl("{indicatorTitle}",""),c=aM(c,j.previewThumbTags)},renderFileActions:function(v,m,A,y,j){if(!v&&!m){return""}var b=this,k=y===!1?"":' data-url="'+y+'"',h=j===!1?"":' data-key="'+j+'"',B=b.getLayoutTemplate("actionDelete"),w="",x=b.getLayoutTemplate("actions"),g=b.otherActionButtons.repl("{dataKey}",h),z=b.fileActionSettings,q=A?z.removeClass+" disabled":z.removeClass;return B=B.repl("{removeClass}",q).repl("{removeIcon}",z.removeIcon).repl("{removeTitle}",z.removeTitle).repl("{dataUrl}",k).repl("{dataKey}",h),v&&(w=b.getLayoutTemplate("actionUpload").repl("{uploadClass}",z.uploadClass).repl("{uploadIcon}",z.uploadIcon).repl("{uploadTitle}",z.uploadTitle)),x.repl("{delete}",B).repl("{upload}",w).repl("{other}",g)},initPreview:function(d){var c,b=this,f=b.initialCaption||"";return ar.count(b.id)?(c=ar.out(b.id),f=d&&b.initialCaption?b.initialCaption:c.caption,b.$preview.html(c.content),b.setCaption(f),void (V(c.content)||b.$container.removeClass("file-input-new"))):(b.$preview.html(""),void (d?b.setCaption(f):b.initCaption()))},initPreviewDeletes:function(){var c=this,b=c.deleteExtraData||{},d=function(){0===c.$preview.find(".kv-file-remove").length&&(c.reset(),c.initialCaption="")};c.$preview.find(".kv-file-remove").each(function(){var a=aH(this),g=a.data("url")||c.deleteUrl,q=a.data("key");if(!V(g)&&void 0!==q){var k,m,e,o,j=a.closest(".file-preview-frame"),n=ar.data[c.id],i=j.data("fileindex");i=parseInt(i.replace("init_","")),e=V(n.config)&&V(n.config[i])?null:n.config[i],o=V(e)||V(e.extra)?b:e.extra,"function"==typeof o&&(o=o()),m={id:a.attr("id"),key:q,extra:o},k=aH.extend({url:g,type:"DELETE",dataType:"json",data:aH.extend({key:q},o),beforeSend:function(f){c.ajaxAborted=!1,c.raise("filepredelete",[q,f,o]),c.ajaxAborted?f.abort():(ax(j,"file-uploading"),ax(a,"disabled"))},success:function(p,h,f){var s,r;return void 0!==p&&void 0!==p.error?(m.jqXHR=f,m.response=p,c.showError(p.error,m,"filedeleteerror"),j.removeClass("file-uploading"),a.removeClass("disabled"),void d()):(ar.unset(c.id,i),s=ar.count(c.id),r=s>0?c.getMsgSelected(s):"",c.raise("filedeleted",[q,f,o]),c.setCaption(r),j.removeClass("file-uploading").addClass("file-deleted"),void j.fadeOut("slow",function(){c.clearObjects(j),j.remove(),d(),s||0!==c.getFileStack().length||(c.setCaption(""),c.reset())}))},error:function(p,h,f){var l=c.parseError(p,f);m.jqXHR=p,m.response={},c.showError(l,m,"filedeleteerror"),j.removeClass("file-uploading"),d()}},c.ajaxDeleteSettings),a.off("click").on("click",function(){aH.ajax(k)})}})},clearObjects:function(a){a.find("video audio").each(function(){this.pause(),aH(this).remove()}),a.find("img object div").each(function(){aH(this).remove()})},clearFileInput:function(){var d,c,b,f=this,e=f.$element;V(e.val())||(f.isIE9||f.isIE10?(d=e.closest("form"),c=aH(document.createElement("form")),b=aH(document.createElement("div")),e.before(b),d.length?d.after(c):b.after(c),c.append(e).trigger("reset"),b.before(e).remove(),c.remove()):e.val(""),f.fileInputCleared=!0)},resetUpload:function(){var a=this;a.uploadCache={content:[],config:[],tags:[],append:!0},a.uploadCount=0,a.uploadPercent=0,a.$btnUpload.removeAttr("disabled"),a.setProgress(0),ax(a.$progress,"hide"),a.resetErrors(!1),a.ajaxAborted=!1,a.ajaxRequests=[]},cancel:function(){var d,c=this,b=c.ajaxRequests,e=b.length;if(e>0){for(d=0;e>d;d+=1){b[d].abort()}}c.getThumbs().each(function(){var g=aH(this),f=g.attr("data-fileindex");g.removeClass("file-uploading"),void 0!==c.filestack[f]&&(g.find(".kv-file-upload").removeClass("disabled").removeAttr("disabled"),g.find(".kv-file-remove").removeClass("disabled").removeAttr("disabled")),c.unlock()})},clear:function(){var c,b=this;b.$btnUpload.removeAttr("disabled"),b.resetUpload(),b.filestack=[],b.clearFileInput(),b.resetErrors(!0),b.raise("fileclear"),!b.overwriteInitial&&ar.count(b.id)?(b.showFileIcon(),b.resetPreview(),b.setEllipsis(),b.initPreviewDeletes(),b.$container.removeClass("file-input-new")):(b.getThumbs().each(function(){b.clearObjects(aH(this))}),b.$preview.html(""),c=!b.overwriteInitial&&b.initialCaption.length>0?b.initialCaption:"",b.setCaption(c),b.setEllipsis(),b.$caption.attr("title",""),ax(b.$container,"file-input-new")),0===b.$container.find(".file-preview-frame").length&&(b.initCaption()||b.$captionContainer.find(".kv-caption-icon").hide(),b.setEllipsis()),b.hideFileIcon(),b.raise("filecleared"),b.$captionContainer.focus(),b.setFileDropZoneTitle()},resetPreview:function(){var b,a=this;ar.count(a.id)?(b=ar.out(a.id),a.$preview.html(b.content),a.setCaption(b.caption)):(a.$preview.html(""),a.initCaption())},reset:function(){var a=this;a.clear(),a.resetPreview(),a.setEllipsis(),a.$container.find(".fileinput-filename").text(""),a.raise("filereset"),a.initialPreview.length>0&&a.$container.removeClass("file-input-new"),a.setFileDropZoneTitle(),a.filestack=[],a.formdata={}},disable:function(){var a=this;a.isDisabled=!0,a.raise("filedisabled"),a.$element.attr("disabled","disabled"),a.$container.find(".kv-fileinput-caption").addClass("file-caption-disabled"),a.$container.find(".btn-file, .fileinput-remove, .kv-fileinput-upload").attr("disabled",!0),a.initDragDrop()},enable:function(){var a=this;a.isDisabled=!1,a.raise("fileenabled"),a.$element.removeAttr("disabled"),a.$container.find(".kv-fileinput-caption").removeClass("file-caption-disabled"),a.$container.find(".btn-file, .fileinput-remove, .kv-fileinput-upload").removeAttr("disabled"),a.initDragDrop()},getThumbs:function(a){return a=a||"",this.$preview.find(".file-preview-frame:not(.file-preview-initial)"+a)},getExtraData:function(){var b=this,a=b.uploadExtraData;return"function"==typeof b.uploadExtraData&&(a=b.uploadExtraData()),a},uploadExtra:function(){var b=this,a=b.getExtraData();0!==a.length&&aH.each(a,function(d,c){b.formdata.append(d,c)})},initXhr:function(c,b){var a=this;return c.upload&&c.upload.addEventListener("progress",function(g){var d=0,h=g.loaded||g.position,f=g.total;g.lengthComputable&&(d=Math.ceil(h/f*b)),a.uploadPercent=Math.max(d,a.uploadPercent),a.setProgress(a.uploadPercent)},!1),c},ajaxSubmit:function(e,d,c,g){var f,b=this;b.uploadExtra(),f=aH.extend({xhr:function(){var a=aH.ajaxSettings.xhr();return b.initXhr(a,98)},url:b.uploadUrl,type:"POST",dataType:"json",data:b.formdata,cache:!1,processData:!1,contentType:!1,beforeSend:e,success:d,complete:c,error:g},b.ajaxSettings),b.ajaxRequests.push(aH.ajax(f))},initUploadSuccess:function(j,q,g){var b,h,f,v,k,m,e,t=this;"object"!=typeof j||aH.isEmptyObject(j)||void 0!==j.initialPreview&&j.initialPreview.length>0&&(t.hasInitData=!0,k=j.initialPreview||[],m=j.initialPreviewConfig||[],e=j.initialPreviewThumbTags||[],b=void 0===j.append||j.append?!0:!1,t.overwriteInitial=!1,void 0===q||g?g?(t.uploadCache.content.push(k[0]),t.uploadCache.config.push(m[0]),t.uploadCache.tags.push(e[0]),t.uploadCache.append=b):(ar.set(t.id,k,m,e,b),t.initPreview(),t.initPreviewDeletes()):(f=ar.add(t.id,k,m[0],e[0],b),h=ar.get(t.id,f,!1),v=aH(h).hide(),q.after(v).fadeOut("slow",function(){v.fadeIn("slow").css("display:inline-block"),t.initPreviewDeletes(),t.clearFileInput()})))},uploadSingle:function(R,aQ,M){var I,O,D,aN,aO,L,A,Z,t,S,N=this,U=N.getFileStack().length,q=new FormData,aP=N.previewInitId+"-"+R,o=aH("#"+aP+":not(.file-preview-initial)"),H=o.find(".kv-file-upload"),j=o.find(".kv-file-remove"),e=o.find(".file-upload-indicator"),B=N.fileActionSettings,z=N.filestack.length>0||!aH.isEmptyObject(N.uploadExtraData),P={id:aP,index:R};N.formdata=q,0===U||!z||H.hasClass("disabled")||N.abort(P)||(D=function(){var a=N.getThumbs(".file-uploading");a.length>0||N.fileBatchCompleted||(N.fileBatchCompleted=!0,setTimeout(function(){ar.set(N.id,N.uploadCache.content,N.uploadCache.config,N.uploadCache.tags,N.uploadCache.append),N.hasInitData&&(N.initPreview(),N.initPreviewDeletes()),N.setProgress(100),N.unlock(),N.clearFileInput(),N.raise("filebatchuploadcomplete",[N.filestack,N.getExtraData()])},100))},aN=function(b,a){e.html(B[b]),e.attr("title",B[a])},aO=function(){!M||0===U||N.uploadPercent>=100||(N.uploadCount+=1,O=80+Math.ceil(20*N.uploadCount/U),N.uploadPercent=Math.max(O,N.uploadPercent),N.setProgress(N.uploadPercent),N.initPreviewDeletes())},L=function(){H.removeAttr("disabled"),j.removeAttr("disabled"),o.removeClass("file-uploading")},A=function(a){I=N.getOutData(a),aN("indicatorLoading","indicatorLoadingTitle"),ax(o,"file-uploading"),H.attr("disabled",!0),j.attr("disabled",!0),M||N.lock(),N.raise("filepreupload",[I,aP,R]),P=aH.extend(P,I),N.abort(P)&&(a.abort(),N.setProgress(100))},Z=function(d,c,b){I=N.getOutData(b,d),P=aH.extend(P,I),setTimeout(function(){void 0===d.error?(aN("indicatorSuccess","indicatorSuccessTitle"),H.hide(),j.hide(),N.filestack[R]=void 0,N.raise("fileuploaded",[I,aP,R]),N.initUploadSuccess(d,o,M),M||N.resetFileStack()):(aN("indicatorError","indicatorErrorTitle"),N.showUploadError(d.error,P))},100)},t=function(){setTimeout(function(){aO(),L(),M?D():N.unlock(!1)},100)},S=function(b,c,a){var d=N.parseError(b,a,M?aQ[R].name:null);aN("indicatorError","indicatorErrorTitle"),P=aH.extend(P,N.getOutData(b)),N.showUploadError(d,P)},q.append(N.uploadFileAttr,aQ[R]),q.append("file_id",R),N.ajaxSubmit(A,Z,t,S))},uploadBatch:function(){var j,y,q,g,b,h,z,m,o=this,e=o.filestack,x=e.length,k=o.filestack.length>0||!aH.isEmptyObject(o.uploadExtraData),w={};o.formdata=new FormData,0!==x&&k&&!o.abort(w)&&(j=o.fileActionSettings,y=function(d,c,i){var f=aH("#"+o.previewInitId+"-"+d).find(".file-upload-indicator");f.html(j[c]),f.attr("title",j[i])},g=function(f){var d=aH("#"+o.previewInitId+"-"+f+":not(.file-preview-initial)"),c=d.find(".kv-file-upload"),l=d.find(".kv-file-delete");d.removeClass("file-uploading"),c.removeAttr("disabled"),l.removeAttr("disabled")},q=function(){aH.each(e,function(a){o.filestack[a]=void 0}),o.clearFileInput()},b=function(c){o.lock();var a=o.getOutData(c);o.showPreview&&o.getThumbs().each(function(){var l=aH(this),f=l.find(".kv-file-upload"),d=l.find(".kv-file-remove");ax(l,"file-uploading"),f.attr("disabled",!0),d.attr("disabled",!0)}),o.raise("filebatchpreupload",[a]),o.abort(a)&&c.abort()},h=function(c,n,a){var t=o.getOutData(a,c),f=o.getThumbs(),p=V(c.errorkeys)?[]:c.errorkeys;void 0===c.error||V(c.error)?(o.raise("filebatchuploadsuccess",[t]),q(),o.showPreview?(f.find(".kv-file-upload").hide(),f.find(".kv-file-remove").hide(),f.each(function(){var l=aH(this),d=l.attr("data-fileindex");y(d,"indicatorSuccess","indicatorSuccessTitle"),g(d)}),o.initUploadSuccess(c)):o.reset()):(o.showPreview&&(f.each(function(){var l=aH(this),d=parseInt(l.attr("data-fileindex"),10);return g(d),0===p.length?void y(d,"indicatorError","indicatorErrorTitle"):void (-1!==aH.inArray(d,p)?y(d,"indicatorError","indicatorErrorTitle"):(l.find(".kv-file-upload").hide(),l.find(".kv-file-remove").hide(),y(d,"indicatorSuccess","indicatorSuccessTitle"),o.filestack[d]=void 0))}),o.initUploadSuccess(c)),o.showUploadError(c.error,t,"filebatchuploaderror"))},z=function(){o.setProgress(100),o.unlock(),o.raise("filebatchuploadcomplete",[o.filestack,o.getExtraData()]),o.clearFileInput()},m=function(f,d,s){var p=o.getOutData(f),c=o.parseError(f,s);o.showUploadError(c,p,"filebatchuploaderror"),o.uploadFileCount=x-1,o.showPreview&&(o.getThumbs().each(function(){var n=aH(this),l=n.attr("data-fileindex");n.removeClass("file-uploading"),void 0!==o.filestack[l]&&y(l,"indicatorError","indicatorErrorTitle")}),o.getThumbs().removeClass("file-uploading"),o.getThumbs(" .kv-file-upload").removeAttr("disabled"),o.getThumbs(" .kv-file-delete").removeAttr("disabled"))},aH.each(e,function(c,a){V(e[c])||o.formdata.append(o.uploadFileAttr,a)}),o.ajaxSubmit(b,h,z,m))},uploadExtraOnly:function(){var g,d,c,b,h=this,f={};h.formdata=new FormData,h.abort(f)||(g=function(j){h.lock();var a=h.getOutData(j);h.raise("filebatchpreupload",[a]),h.setProgress(50),f.data=a,f.xhr=j,h.abort(f)&&(j.abort(),h.setProgress(100))},d=function(m,l,k){var j=h.getOutData(k,m);void 0===m.error||V(m.error)?(h.raise("filebatchuploadsuccess",[j]),h.clearFileInput(),h.initUploadSuccess(m)):h.showUploadError(m.error,j,"filebatchuploaderror")},c=function(){h.setProgress(100),h.unlock(),h.raise("filebatchuploadcomplete",[h.filestack,h.getExtraData()]),h.clearFileInput()},b=function(o,n,m){var k=h.getOutData(o),j=h.parseError(o,m);f.data=k,h.showUploadError(j,k,"filebatchuploaderror")},h.ajaxSubmit(g,d,c,b))},hideFileIcon:function(){this.overwriteInitial&&this.$captionContainer.find(".kv-caption-icon").hide()},showFileIcon:function(){this.$captionContainer.find(".kv-caption-icon").show()},resetErrors:function(c){var b=this,a=b.$errorContainer;b.isError=!1,b.$container.removeClass("has-error"),a.html(""),c?a.fadeOut("slow"):a.hide()},showFolderError:function(c){var b=this,a=b.$errorContainer;c&&(a.html(b.msgFoldersNotAllowed.repl("{n}",c)),a.fadeIn(800),ax(b.$container,"has-error"),b.raise("filefoldererror",[c]))},showUploadError:function(g,d,c){var b=this,h=b.$errorContainer,f=c||"fileuploaderror";return 0===h.find("ul").length?h.html("<ul><li>"+g+"</li></ul>"):h.find("ul").append("<li>"+g+"</li>"),h.fadeIn(800),b.raise(f,[d]),ax(b.$container,"has-error"),!0},showError:function(g,d,c){var b=this,h=b.$errorContainer,f=c||"fileerror";return d=d||{},d.reader=b.reader,h.html(g),h.fadeIn(800),b.raise(f,[d]),b.isUploadable||b.clearFileInput(),ax(b.$container,"has-error"),b.$btnUpload.attr("disabled",!0),!0},errorHandler:function(f,d){var c=this,b=f.target.error;switch(b.code){case b.NOT_FOUND_ERR:c.showError(c.msgFileNotFound.repl("{name}",d));break;case b.SECURITY_ERR:c.showError(c.msgFileSecured.repl("{name}",d));break;case b.NOT_READABLE_ERR:c.showError(c.msgFileNotReadable.repl("{name}",d));break;case b.ABORT_ERR:c.showError(c.msgFilePreviewAborted.repl("{name}",d));break;default:c.showError(c.msgFilePreviewError.repl("{name}",d))}},parseFileType:function(g){var d,c,b,h,f=this;for(h=0;h<aj.length;h+=1){if(b=aj[h],d=aa(b,f.fileTypeSettings)?f.fileTypeSettings[b]:X[b],c=d(g.type,g.name)?b:"",!V(c)){return c}}return"other"},previewDefault:function(j,u,q){if(this.showPreview){var g=this,b=av.createObjectURL(j),h=aH("#"+u),f=g.previewSettings.other,v=g.renderFileFooter(j.name,f.width),k=g.getPreviewTemplate("other"),m=u.slice(u.lastIndexOf("-")+1),e="";q===!0&&(e=" btn disabled",v+='<div class="file-other-error text-danger"><i class="glyphicon glyphicon-exclamation-sign"></i></div>'),g.$preview.append("\n"+k.repl("{previewId}",u).repl("{frameClass}",e).repl("{fileindex}",m).repl("{caption}",g.slug(j.name)).repl("{width}",f.width).repl("{height}",f.height).repl("{type}",j.type).repl("{data}",b).repl("{footer}",v)),h.on("load",function(){av.revokeObjectURL(h.attr("data"))})}},previewFile:function(R,M,z,Z){if(this.showPreview){var H,D,L,F,A=this,S=A.parseFileType(R),T=A.slug(R.name),E=A.allowedPreviewTypes,y=A.allowedPreviewMimeTypes,P=A.getPreviewTemplate(S),q=aa(S,A.previewSettings)?A.previewSettings[S]:ab[S],N=parseInt(A.wrapTextLength,10),I=A.wrapIndicator,O=E.indexOf(S)>=0,k=V(y)||!V(y)&&-1!==y.indexOf(R.type),U=A.renderFileFooter(T,q.width),j="",B=z.slice(z.lastIndexOf("-")+1);O&&k?("text"===S?(D=G(M.target.result),av.revokeObjectURL(Z),D.length>N&&(L="text-"+Y(),F=0.75*window.innerHeight,j=A.getLayoutTemplate("modal").repl("{id}",L).repl("{title}",T).repl("{height}",F).repl("{body}",D),I=I.repl("{title}",T).repl("{dialog}","$('#"+L+"').modal('show')"),D=D.substring(0,N-1)+I),H=P.repl("{previewId}",z).repl("{caption}",T).repl("{frameClass}","").repl("{type}",R.type).repl("{width}",q.width).repl("{height}",q.height).repl("{data}",D).repl("{footer}",U).repl("{fileindex}",B)+j):H=P.repl("{previewId}",z).repl("{caption}",T).repl("{frameClass}","").repl("{type}",R.type).repl("{data}",Z).repl("{width}",q.width).repl("{height}",q.height).repl("{footer}",U).repl("{fileindex}",B),A.$preview.append("\n"+H),A.autoSizeImage(z)):A.previewDefault(R,z)}},slugDefault:function(a){return V(a)?"":a.split(/(\\|\/)/g).pop().replace(/[^\w\u00C0-\u017F\-.\\\/ ]+/g,"")},getFileStack:function(){var a=this;return a.filestack.filter(function(b){return void 0!==b})},readFiles:function(m){function C(M){if(V(j.attr("multiple"))&&(B=1),M>=B){return z.isUploadable&&z.filestack.length>0?z.raise("filebatchselected",[z.getFileStack()]):z.raise("filebatchselected",[m]),g.removeClass("loading"),void D.html("")}var u,L,o,N,n,t,i=A+M,c=e+"-"+i,r=m[M],p=z.slug(r.name),v=(r.size||0)/1000,d="",l=av.createObjectURL(r),s=0,h=z.allowedFileTypes,f=V(h)?"":h.join(", "),a=z.allowedFileExtensions,H=V(a)?"":a.join(", ");if(V(a)||(d=new RegExp("\\.("+a.join("|")+")$","i")),v=v.toFixed(2),z.maxFileSize>0&&v>z.maxFileSize){return N=z.msgSizeTooLarge.repl("{name}",p).repl("{size}",v).repl("{maxSize}",z.maxFileSize),void (z.isError=q(N,r,c,M))}if(!V(h)&&al(h)){for(o=0;o<h.length;o+=1){n=h[o],L=w[n],t=void 0!==L&&L(r.type,p),s+=V(t)?0:t.length}if(0===s){return N=z.msgInvalidFileType.repl("{name}",p).repl("{types}",f),void (z.isError=q(N,r,c,M))}}return 0!==s||V(a)||!al(a)||V(d)||(t=p.match(d),s+=V(t)?0:t.length,0!==s)?z.showPreview?(b.length>0&&void 0!==FileReader?(D.html(x.repl("{index}",M+1).repl("{files}",B)),g.addClass("loading"),k.onerror=function(E){z.errorHandler(E,p)},k.onload=function(E){z.previewFile(r,E,c,l),z.initFileActions()},k.onloadend=function(){N=y.repl("{index}",M+1).repl("{files}",B).repl("{percent}",50).repl("{name}",p),setTimeout(function(){D.html(N),av.revokeObjectURL(l)},100),setTimeout(function(){C(M+1),z.updateFileDetails(B)},100),z.raise("fileloaded",[r,c,M,k])},k.onprogress=function(I){if(I.lengthComputable){var F=I.loaded/I.total*100,E=Math.ceil(F);N=y.repl("{index}",M+1).repl("{files}",B).repl("{percent}",E).repl("{name}",p),setTimeout(function(){D.html(N)},100)}},u=aa("text",w)?w.text:X.text,u(r.type,p)?k.readAsText(r,z.textEncoding):k.readAsArrayBuffer(r)):(z.previewDefault(r,c),setTimeout(function(){C(M+1),z.updateFileDetails(B)},100),z.raise("fileloaded",[r,c,M,k])),void z.filestack.push(r)):(z.filestack.push(r),setTimeout(C(M+1),100),void z.raise("fileloaded",[r,c,M,k])):(N=z.msgInvalidFileExtension.repl("{name}",p).repl("{extensions}",H),void (z.isError=q(N,r,c,M)))}this.reader=new FileReader;var z=this,j=z.$element,b=z.$preview,k=z.reader,g=z.$previewContainer,D=z.$previewStatus,x=z.msgLoading,y=z.msgProgress,e=z.previewInitId,B=m.length,w=z.fileTypeSettings,A=z.filestack.length,q=function(c,i,f,a){var h=aH.extend(z.getOutData({},{},m),{id:f,index:a}),d={id:f,index:a,file:i,files:m};return z.previewDefault(i,f,!0),z.isUploadable?z.showUploadError(c,h):z.showError(c,d)};C(0),z.updateFileDetails(B,!1)},updateFileDetails:function(j){var h=this,m=h.$element,f=h.getFileStack(),b=m.val()||f.length&&f[0].name||"",g=h.slug(b),c=h.isUploadable?f.length:j,p=ar.count(h.id)+c,k=c>1?h.getMsgSelected(p):g;h.isError?(h.$previewContainer.removeClass("loading"),h.$previewStatus.html(""),h.$captionContainer.find(".kv-caption-icon").hide()):h.showFileIcon(),h.setCaption(k,h.isError),h.$container.removeClass("file-input-new file-input-ajax-new"),1===arguments.length&&h.raise("fileselect",[j,g]),ar.count(h.id)&&h.initPreviewDeletes()},change:function(x){var D=this,k=D.$element;if(!D.isUploadable&&V(k.val())&&D.fileInputCleared){return void (D.fileInputCleared=!1)}D.fileInputCleared=!1;var b,t,j,I,B=D.$preview,C=arguments.length>1,e=C?x.originalEvent.dataTransfer.files:k.get(0).files,H=V(k.attr("multiple")),A=0,F=0,y=D.filestack.length,q=D.isUploadable,z=function(d,c,h,f){var a=aH.extend(D.getOutData({},{},e),{id:h,index:f}),g={id:h,index:f,file:c,files:e};return D.isUploadable?D.showUploadError(d,a):D.showError(d,g)};if(D.reader=null,D.resetUpload(),D.hideFileIcon(),D.isUploadable&&D.$container.find(".file-drop-zone ."+D.dropZoneTitleClass).remove(),C){for(b=[];e[A];){I=e[A],I.type||I.size%4096!==0?b.push(I):F++,A++}}else{b=void 0===x.target.files?x.target&&x.target.value?[{name:x.target.value.replace(/^.+\\/,"")}]:[]:x.target.files}if(V(b)||0===b.length){return q||D.clear(),D.showFolderError(F),void D.raise("fileselectnone")}if(D.resetErrors(),!q||H&&y>0){if(!D.overwriteInitial&&ar.count(D.id)){var E=ar.out(D.id);B.html(E.content),D.setCaption(E.caption),D.initPreviewDeletes()}else{B.html("")}H&&y>0&&(D.filestack=[])}return j=D.isUploadable?D.getFileStack().length+b.length:b.length,D.maxFileCount>0&&j>D.maxFileCount?(t=D.msgFilesTooMany.repl("{m}",D.maxFileCount).repl("{n}",j),D.isError=z(t,null,null,null),D.$captionContainer.find(".kv-caption-icon").hide(),D.$caption.html(D.msgValidationError),D.setEllipsis(),void D.$container.removeClass("file-input-new file-input-ajax-new")):(D.isIE9?D.updateFileDetails(1):D.readFiles(b),void D.showFolderError(F))},autoSizeImage:function(h){var f,d,c,k=this,g=k.$preview,b=g.find("#"+h),j=b.find("img");j.length&&j.on("load",function(){f=b.width(),d=g.width(),f>d&&(j.css("width","100%"),b.css("width","97%")),c=j.closest(".file-preview-frame").find(".file-caption-name"),c.length&&(c.width(j.width()),c.attr("title",c.text())),k.raise("fileimageloaded",h)})},initCaption:function(){var b,a=this;return a.overwriteInitial?(a.$caption.html(""),!1):(b=a.initialCaption||"",a.setCaption(b),!0)},setCaption:function(e,d){var c,g,f=this,b=d||!1;if(b){c=aH("<div>"+f.msgValidationError+"</div>").text(),g='<span class="'+f.msgValidationErrorClass+'">'+f.msgValidationErrorIcon+c+"</span>"}else{if(V(e)||0===f.$caption.length){return}c=aH("<div>"+e+"</div>").text(),g=f.getLayoutTemplate("icon")+c}f.$caption.html(g),f.$caption.attr("title",c),f.$captionContainer.find(".file-caption-ellipsis").attr("title",c),f.setEllipsis()},initBrowse:function(b){var a=this;a.$btnFile=b.find(".btn-file"),a.$btnFile.append(a.$element)},createContainer:function(){var b=this,a=aH(document.createElement("span")).attr({"class":"file-input file-input-new"}).html(b.renderMain());return b.$element.before(a),b.initBrowse(a),a},refreshContainer:function(){var b=this,a=b.$container;a.before(b.$element),a.html(b.renderMain()),b.initBrowse(a)},renderMain:function(){var f=this,d=f.isUploadable&&f.dropZoneEnabled?" file-drop-zone":"",c=f.showPreview?f.getLayoutTemplate("preview").repl("{class}",f.previewClass).repl("{dropClass}",d):"",b=f.isDisabled?f.captionClass+" file-caption-disabled":f.captionClass,g=f.captionTemplate.repl("{class}",b+" kv-fileinput-caption");return f.mainTemplate.repl("{class}",f.mainClass).repl("{preview}",c).repl("{caption}",g).repl("{upload}",f.renderUpload()).repl("{remove}",f.renderRemove()).repl("{cancel}",f.renderCancel()).repl("{browse}",f.renderBrowse())},renderBrowse:function(){var c=this,b=c.browseClass+" btn-file",a="";return c.isDisabled&&(a=" disabled "),'<div class="'+b+'"'+a+"> "+c.browseIcon+c.browseLabel+" </div>"},renderRemove:function(){var c=this,b=c.removeClass+" fileinput-remove fileinput-remove-button",a="";return c.showRemove?(c.isDisabled&&(a=" disabled "),'<button type="button" title="'+c.removeTitle+'" class="'+b+'"'+a+">"+c.removeIcon+c.removeLabel+"</button>"):""},renderCancel:function(){var b=this,a=b.cancelClass+" fileinput-cancel fileinput-cancel-button";return b.showCancel?'<button type="button" title="'+b.cancelTitle+'" class="hide '+a+'">'+b.cancelIcon+b.cancelLabel+"</button>":""},renderUpload:function(){var f=this,d=f.uploadClass+" kv-fileinput-upload fileinput-upload-button",c="",b="";return f.showUpload?(f.isDisabled&&(b=" disabled "),c=!f.isUploadable||f.isDisabled?'<button type="submit" title="'+f.uploadTitle+'"class="'+d+'"'+b+">"+f.uploadIcon+f.uploadLabel+"</button>":'<a href="'+f.uploadUrl+'" title="'+f.uploadTitle+'" class="'+d+'"'+b+">"+f.uploadIcon+f.uploadLabel+"</a>"):""}},aH.fn.fileinput=function(c){if(ay()||aD(9)){var b=Array.apply(null,arguments);return b.shift(),this.each(function(){var a=aH(this),e=a.data("fileinput"),d="object"==typeof c&&c;e||(e=new ad(this,aH.extend({},aH.fn.fileinput.defaults,d,aH(this).data())),a.data("fileinput",e)),"string"==typeof c&&e[c].apply(e,b)})}},aH.fn.fileinput.defaults={showCaption:!0,showPreview:!0,showRemove:!0,showUpload:!0,showCancel:!0,mainClass:"",previewClass:"",captionClass:"",mainTemplate:null,initialCaption:"",initialPreview:[],initialPreviewDelimiter:"*$$*",initialPreviewConfig:[],initialPreviewThumbTags:[],previewThumbTags:{},initialPreviewShowDelete:!0,deleteUrl:"",deleteExtraData:{},overwriteInitial:!0,layoutTemplates:J,previewTemplates:aC,allowedPreviewTypes:aj,allowedPreviewMimeTypes:null,allowedFileTypes:null,allowedFileExtensions:null,customLayoutTags:{},customPreviewTags:{},previewSettings:ab,fileTypeSettings:X,previewFileIcon:'<i class="glyphicon glyphicon-file"></i>',browseIcon:'<i class="glyphicon glyphicon-folder-open"></i> &nbsp;',browseClass:"btn btn-primary",removeIcon:'<i class="glyphicon glyphicon-trash"></i> ',removeClass:"btn btn-default",cancelIcon:'<i class="glyphicon glyphicon-ban-circle"></i> ',cancelClass:"btn btn-default",uploadIcon:'<i class="glyphicon glyphicon-upload"></i> ',uploadClass:"btn btn-default",uploadUrl:null,uploadAsync:!0,uploadExtraData:{},maxFileSize:0,minFileCount:0,maxFileCount:0,msgValidationErrorClass:"text-danger",msgValidationErrorIcon:'<i class="glyphicon glyphicon-exclamation-sign"></i> ',msgErrorClass:"file-error-message",progressClass:"progress-bar progress-bar-success progress-bar-striped active",progressCompleteClass:"progress-bar progress-bar-success",previewFileType:"image",wrapTextLength:250,wrapIndicator:' <span class="wrap-indicator" title="{title}" onclick="{dialog}">[&hellip;]</span>',elCaptionContainer:null,elCaptionText:null,elPreviewContainer:null,elPreviewImage:null,elPreviewStatus:null,elErrorContainer:null,slugCallback:null,dropZoneEnabled:!0,dropZoneTitleClass:"file-drop-zone-title",fileActionSettings:{},otherActionButtons:"",textEncoding:"UTF-8",ajaxSettings:{},ajaxDeleteSettings:{},showAjaxErrorDetails:!0},aH.fn.fileinput.locales={},aH.fn.fileinput.locales.en={fileSingle:"file",filePlural:"files",browseLabel:"Browse &hellip;",removeLabel:"Remove",removeTitle:"Clear selected files",cancelLabel:"Cancel",cancelTitle:"Abort ongoing upload",uploadLabel:"Upload",uploadTitle:"Upload selected files",msgSizeTooLarge:'File "{name}" (<b>{size} KB</b>) exceeds maximum allowed upload size of <b>{maxSize} KB</b>. Please retry your upload!',msgFilesTooLess:"You must select at least <b>{n}</b> {files} to upload. Please retry your upload!",msgFilesTooMany:"Number of files selected for upload <b>({n})</b> exceeds maximum allowed limit of <b>{m}</b>. Please retry your upload!",msgFileNotFound:'File "{name}" not found!',msgFileSecured:'Security restrictions prevent reading the file "{name}".',msgFileNotReadable:'File "{name}" is not readable.',msgFilePreviewAborted:'File preview aborted for "{name}".',msgFilePreviewError:'An error occurred while reading the file "{name}".',msgInvalidFileType:'Invalid type for file "{name}". Only "{types}" files are supported.',msgInvalidFileExtension:'Invalid extension for file "{name}". Only "{extensions}" files are supported.',msgValidationError:"File Upload Error",msgLoading:"Loading file {index} of {files} &hellip;",msgProgress:"Loading file {index} of {files} - {name} - {percent}% completed.",msgSelected:"{n} {files} selected",msgFoldersNotAllowed:"Drag & drop files only! {n} folder(s) dropped were skipped.",dropZoneTitle:"Drag & drop files here &hellip;"},aH.extend(aH.fn.fileinput.defaults,aH.fn.fileinput.locales.en),aH.fn.fileinput.Constructor=ad,aH(document).ready(function(){var b=aH("input.file[type=file]"),a=b.attr("type")?b.length:0;a>0&&b.fileinput()})}(window.jQuery);