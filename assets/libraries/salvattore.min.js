var salvattore=function(a,b){"use strict";var d={},e=[],f=[],g=[],h=function(a,b,c){a.dataset?a.dataset[b]=c:a.setAttribute("data-"+b,c)};return d.obtainGridSettings=function(b){var c=a.getComputedStyle(b,":before"),d=c.getPropertyValue("content").slice(1,-1),e=d.match(/^\s*(\d+)(?:\s?\.(.+))?\s*$/),f=1,g=[];return e?(f=e[1],g=e[2],g=g?g.split("."):["column"]):(e=d.match(/^\s*\.(.+)\s+(\d+)\s*$/),e&&(g=e[1],f=e[2],f&&(f=f.split(".")))),{numberOfColumns:f,columnClasses:g}},d.addColumns=function(a,c){for(var l,e=d.obtainGridSettings(a),f=e.numberOfColumns,g=e.columnClasses,i=new Array(+f),j=b.createDocumentFragment(),k=f;0!==k--;)l="[data-columns] > *:nth-child("+f+"n-"+k+")",i.push(c.querySelectorAll(l));i.forEach(function(a){var c=b.createElement("div"),d=b.createDocumentFragment();c.className=g.join(" "),Array.prototype.forEach.call(a,function(a){d.appendChild(a)}),c.appendChild(d),j.appendChild(c)}),a.appendChild(j),h(a,"columns",f)},d.removeColumns=function(c){var d=b.createRange();d.selectNodeContents(c);var e=Array.prototype.filter.call(d.extractContents().childNodes,function(b){return b instanceof a.HTMLElement}),f=e.length,g=e[0].childNodes.length,i=new Array(g*f);Array.prototype.forEach.call(e,function(a,b){Array.prototype.forEach.call(a.children,function(a,c){i[c*f+b]=a})});var j=b.createElement("div");return h(j,"columns",0),i.filter(function(a){return!!a}).forEach(function(a){j.appendChild(a)}),j},d.recreateColumns=function(b){a.requestAnimationFrame(function(){d.addColumns(b,d.removeColumns(b));var a=new CustomEvent("columnsChange");b.dispatchEvent(a)})},d.mediaQueryChange=function(a){a.matches&&Array.prototype.forEach.call(e,d.recreateColumns)},d.getCSSRules=function(a){var b;try{b=a.sheet.cssRules||a.sheet.rules}catch(c){return[]}return b||[]},d.getStylesheets=function(){return Array.prototype.concat.call(Array.prototype.slice.call(b.querySelectorAll("style[type='text/css']")),Array.prototype.slice.call(b.querySelectorAll("link[rel='stylesheet']")))},d.mediaRuleHasColumnsSelector=function(a){var b,c;try{b=a.length}catch(d){b=0}for(;b--;)if(c=a[b],c.selectorText&&c.selectorText.match(/\[data-columns\](.*)::?before$/))return!0;return!1},d.scanMediaQueries=function(){var b=[];if(a.matchMedia){d.getStylesheets().forEach(function(a){Array.prototype.forEach.call(d.getCSSRules(a),function(a){a.media&&a.cssRules&&d.mediaRuleHasColumnsSelector(a.cssRules)&&b.push(a)})});var c=f.filter(function(a){return-1===b.indexOf(a)});g.filter(function(a){return-1!==c.indexOf(a.rule)}).forEach(function(a){a.mql.removeListener(d.mediaQueryChange)}),g=g.filter(function(a){return-1===c.indexOf(a.rule)}),b.filter(function(a){return-1==f.indexOf(a)}).forEach(function(b){var c=a.matchMedia(b.media.mediaText);c.addListener(d.mediaQueryChange),g.push({rule:b,mql:c})}),f.length=0,f=b}},d.rescanMediaQueries=function(){d.scanMediaQueries(),Array.prototype.forEach.call(e,d.recreateColumns)},d.nextElementColumnIndex=function(a,b){var f,g,h,c=a.children,d=c.length,e=0,i=0;for(h=0;d>h;h++)f=c[h],g=f.children.length+(b[h].children||b[h].childNodes).length,0===e&&(e=g),e>g&&(i=h,e=g);return i},d.createFragmentsList=function(a){for(var c=new Array(a),d=0;d!==a;)c[d]=b.createDocumentFragment(),d++;return c},d.appendElements=function(a,b){var c=a.children,e=c.length,f=d.createFragmentsList(e);Array.prototype.forEach.call(b,function(b){var c=d.nextElementColumnIndex(a,f);f[c].appendChild(b)}),Array.prototype.forEach.call(c,function(a,b){a.appendChild(f[b])})},d.prependElements=function(a,c,e){var f=a.children,g=f.length,h=d.createFragmentsList(g),i=g-1,e="undefined"==typeof e?0:e;c.forEach(function(a){var b=h[i];b.insertBefore(a,b.firstChild),0===i?i=g-1:i--}),Array.prototype.forEach.call(f,function(a,b){a.insertBefore(h[b],a.firstChild)});for(var j=b.createDocumentFragment(),k=c.length%g;0!==k--;)j.appendChild(a.lastChild);a.insertBefore(j,a.children[e])},d.registerGrid=function(c){if("none"!==a.getComputedStyle(c).display){var f=b.createRange();f.selectNodeContents(c);var g=b.createElement("div");g.appendChild(f.extractContents()),h(g,"columns",0),d.addColumns(c,g),e.push(c)}},d.init=function(){var a=b.createElement("style");a.innerHTML="[data-columns]::before{visibility:hidden;position:absolute;font-size:1px;}",b.head.appendChild(a);var c=b.querySelectorAll("[data-columns]");Array.prototype.forEach.call(c,d.registerGrid),d.scanMediaQueries()},d.init(),{appendElements:d.appendElements,prependElements:d.prependElements,registerGrid:d.registerGrid,recreateColumns:d.recreateColumns,rescanMediaQueries:d.rescanMediaQueries,append_elements:d.appendElements,prepend_elements:d.prependElements,register_grid:d.registerGrid,recreate_columns:d.recreateColumns,rescan_media_queries:d.rescanMediaQueries}}(window,window.document);window.onresize=function(){salvattore.rescanMediaQueries()};