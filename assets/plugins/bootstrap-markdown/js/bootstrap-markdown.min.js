!function(a){"use strict";var b=function(b,c){this.$ns="bootstrap-markdown",this.$element=a(b),this.$editable={el:null,type:null,attrKeys:[],attrValues:[],content:null},this.$options=a.extend(!0,{},a.fn.markdown.defaults,c,this.$element.data(),this.$element.data("options")),this.$oldContent=null,this.$isPreview=!1,this.$isFullscreen=!1,this.$editor=null,this.$textarea=null,this.$handler=[],this.$callback=[],this.$nextTab=[],this.showEditor()};b.prototype={constructor:b,__alterButtons:function(b,c){var d=this.$handler,e="all"==b,f=this;a.each(d,function(a,d){var g=!0;g=e?!1:d.indexOf(b)<0,0==g&&c(f.$editor.find('button[data-handler="'+d+'"]'))})},__buildButtons:function(b,c){var d,e=this.$ns,f=this.$handler,g=this.$callback;for(d=0;d<b.length;d++){var h,i=b[d];for(h=0;h<i.length;h++){var j,k=i[h].data,l=a("<div/>",{"class":"btn-group"});for(j=0;j<k.length;j++){var n,o,m=k[j],p=e+"-"+m.name,q=this.__getIcon(m.icon),r=m.btnText?m.btnText:"",s=m.btnClass?m.btnClass:"btn",t=m.tabIndex?m.tabIndex:"-1",u="undefined"!=typeof m.hotkey?m.hotkey:"",v="undefined"!=typeof jQuery.hotkeys&&""!==u?" ("+u+")":"";n=a("<button></button>"),n.text(" "+this.__localize(r)).addClass("btn-default btn-sm").addClass(s),s.match(/btn\-(primary|success|info|warning|danger|link)/)&&n.removeClass("btn-default"),n.attr({type:"button",title:this.__localize(m.title)+v,tabindex:t,"data-provider":e,"data-handler":p,"data-hotkey":u}),1==m.toggle&&n.attr("data-toggle","button"),o=a("<span/>"),o.addClass(q),o.prependTo(n),l.append(n),f.push(p),g.push(m.callback)}c.append(l)}}return c},__setListener:function(){var b="undefined"!=typeof this.$textarea.attr("rows"),c=this.$textarea.val().split("\n").length>5?this.$textarea.val().split("\n").length:"5",d=b?this.$textarea.attr("rows"):c;this.$textarea.attr("rows",d),this.$options.resize&&this.$textarea.css("resize",this.$options.resize),this.$textarea.on("focus",a.proxy(this.focus,this)).on("keypress",a.proxy(this.keypress,this)).on("keyup",a.proxy(this.keyup,this)).on("change",a.proxy(this.change,this)),this.eventSupported("keydown")&&this.$textarea.on("keydown",a.proxy(this.keydown,this)),this.$textarea.data("markdown",this)},__handle:function(b){var c=a(b.currentTarget),d=this.$handler,e=this.$callback,f=c.attr("data-handler"),g=d.indexOf(f),h=e[g];a(b.currentTarget).focus(),h(this),this.change(this),f.indexOf("cmdSave")<0&&this.$textarea.focus(),b.preventDefault()},__localize:function(b){var c=a.fn.markdown.messages,d=this.$options.language;return"undefined"!=typeof c&&"undefined"!=typeof c[d]&&"undefined"!=typeof c[d][b]?c[d][b]:b},__getIcon:function(a){return"object"==typeof a?a[this.$options.iconlibrary]:a},setFullscreen:function(b){var c=this.$editor,d=this.$textarea;b===!0?(c.addClass("md-fullscreen-mode"),a("body").addClass("md-nooverflow"),this.$options.onFullscreen(this)):(c.removeClass("md-fullscreen-mode"),a("body").removeClass("md-nooverflow")),this.$isFullscreen=b,d.focus()},showEditor:function(){var c,b=this,d=this.$ns,e=this.$element,h=(e.css("height"),e.css("width"),this.$editable),i=this.$handler,j=this.$callback,k=this.$options,l=a("<div/>",{"class":"md-editor",click:function(){b.focus()}});if(null==this.$editor){var m=a("<div/>",{"class":"md-header btn-toolbar"}),n=[];if(k.buttons.length>0&&(n=n.concat(k.buttons[0])),k.additionalButtons.length>0&&(n=n.concat(k.additionalButtons[0])),k.reorderButtonGroups.length>0&&(n=n.filter(function(a){return k.reorderButtonGroups.indexOf(a.name)>-1}).sort(function(a,b){return k.reorderButtonGroups.indexOf(a.name)<k.reorderButtonGroups.indexOf(b.name)?-1:k.reorderButtonGroups.indexOf(a.name)>k.reorderButtonGroups.indexOf(b.name)?1:0})),n.length>0&&(m=this.__buildButtons([n],m)),k.fullscreen.enable&&m.append('<div class="md-controls"><a class="md-control md-control-fullscreen" href="#"><span class="'+this.__getIcon(k.fullscreen.icons.fullscreenOn)+'"></span></a></div>').on("click",".md-control-fullscreen",function(a){a.preventDefault(),b.setFullscreen(!0)}),l.append(m),e.is("textarea"))e.before(l),c=e,c.addClass("md-input"),l.append(c);else{var o="function"==typeof toMarkdown?toMarkdown(e.html()):e.html(),p=a.trim(o);c=a("<textarea/>",{"class":"md-input",val:p}),l.append(c),h.el=e,h.type=e.prop("tagName").toLowerCase(),h.content=e.html(),a(e[0].attributes).each(function(){h.attrKeys.push(this.nodeName),h.attrValues.push(this.nodeValue)}),e.replaceWith(l)}var q=a("<div/>",{"class":"md-footer"}),r=!1,s="";if(k.savable){r=!0;var t="cmdSave";i.push(t),j.push(k.onSave),q.append('<button class="btn btn-success" data-provider="'+d+'" data-handler="'+t+'"><i class="icon icon-white icon-ok"></i> '+this.__localize("Save")+"</button>")}if(s="function"==typeof k.footer?k.footer(this):k.footer,""!==a.trim(s)&&(r=!0,q.append(s)),r&&l.append(q),k.width&&"inherit"!==k.width&&(jQuery.isNumeric(k.width)?(l.css("display","table"),c.css("width",k.width+"px")):l.addClass(k.width)),k.height&&"inherit"!==k.height)if(jQuery.isNumeric(k.height)){var u=k.height;m&&(u=Math.max(0,u-m.outerHeight())),q&&(u=Math.max(0,u-q.outerHeight())),c.css("height",u+"px")}else l.addClass(k.height);this.$editor=l,this.$textarea=c,this.$editable=h,this.$oldContent=this.getContent(),this.__setListener(),this.$editor.attr("id",(new Date).getTime()),this.$editor.on("click",'[data-provider="bootstrap-markdown"]',a.proxy(this.__handle,this)),(this.$element.is(":disabled")||this.$element.is("[readonly]"))&&(this.$editor.addClass("md-editor-disabled"),this.disableButtons("all")),this.eventSupported("keydown")&&"object"==typeof jQuery.hotkeys&&m.find('[data-provider="bootstrap-markdown"]').each(function(){var b=a(this),d=b.attr("data-hotkey");""!==d.toLowerCase()&&c.bind("keydown",d,function(){return b.trigger("click"),!1})}),"preview"===k.initialstate?this.showPreview():"fullscreen"===k.initialstate&&k.fullscreen.enable&&this.setFullscreen(!0)}else this.$editor.show();return k.autofocus&&(this.$textarea.focus(),this.$editor.addClass("active")),k.fullscreen.enable&&k.fullscreen!==!1&&(this.$editor.append('          <div class="md-fullscreen-controls">            <a href="#" class="exit-fullscreen" title="Exit fullscreen"><span class="'+this.__getIcon(k.fullscreen.icons.fullscreenOff)+'"></span></a>          </div>'),this.$editor.on("click",".exit-fullscreen",function(a){a.preventDefault(),b.setFullscreen(!1)})),this.hideButtons(k.hiddenButtons),this.disableButtons(k.disabledButtons),k.onShow(this),this},parseContent:function(){var a,b=this.$options.onPreview(this);if("string"==typeof b)a=b;else{var c=this.$textarea.val();a="object"==typeof markdown?markdown.toHTML(c):"function"==typeof marked?marked(c):c}return a},showPreview:function(){var f,c=(this.$options,this.$textarea),d=c.next(),e=a("<div/>",{"class":"md-preview","data-provider":"markdown-preview"});return this.$isPreview=!0,this.disableButtons("all").enableButtons("cmdPreview"),f=this.parseContent(),e.html(f),d&&"md-footer"==d.attr("class")?e.insertBefore(d):c.parent().append(e),e.css({width:c.outerWidth()+"px",height:c.outerHeight()+"px"}),this.$options.resize&&e.css("resize",this.$options.resize),c.hide(),e.data("markdown",this),(this.$element.is(":disabled")||this.$element.is("[readonly]"))&&(this.$editor.addClass("md-editor-disabled"),this.disableButtons("all")),this},hidePreview:function(){this.$isPreview=!1;var a=this.$editor.find('div[data-provider="markdown-preview"]');return a.remove(),this.enableButtons("all"),this.disableButtons(this.$options.disabledButtons),this.$textarea.show(),this.__setListener(),this},isDirty:function(){return this.$oldContent!=this.getContent()},getContent:function(){return this.$textarea.val()},setContent:function(a){return this.$textarea.val(a),this},findSelection:function(a){var c,b=this.getContent();if(c=b.indexOf(a),c>=0&&a.length>0){var e,d=this.getSelection();return this.setSelection(c,c+a.length),e=this.getSelection(),this.setSelection(d.start,d.end),e}return null},getSelection:function(){var a=this.$textarea[0];return("selectionStart"in a&&function(){var b=a.selectionEnd-a.selectionStart;return{start:a.selectionStart,end:a.selectionEnd,length:b,text:a.value.substr(a.selectionStart,b)}}||function(){return null})()},setSelection:function(a,b){var c=this.$textarea[0];return("selectionStart"in c&&function(){c.selectionStart=a,c.selectionEnd=b}||function(){return null})()},replaceSelection:function(a){var b=this.$textarea[0];return("selectionStart"in b&&function(){return b.value=b.value.substr(0,b.selectionStart)+a+b.value.substr(b.selectionEnd,b.value.length),b.selectionStart=b.value.length,this}||function(){return b.value+=a,jQuery(b)})()},getNextTab:function(){if(0==this.$nextTab.length)return null;var a,b=this.$nextTab.shift();return"function"==typeof b?a=b():"object"==typeof b&&b.length>0&&(a=b),a},setNextTab:function(a,b){if("string"==typeof a){var c=this;this.$nextTab.push(function(){return c.findSelection(a)})}else if("number"==typeof a&&"number"==typeof b){var d=this.getSelection();this.setSelection(a,b),this.$nextTab.push(this.getSelection()),this.setSelection(d.start,d.end)}},__parseButtonNameParam:function(a){var b=[];return"string"==typeof a?b.push(a):b=a,b},enableButtons:function(b){var c=this.__parseButtonNameParam(b),d=this;return a.each(c,function(a){d.__alterButtons(c[a],function(a){a.removeAttr("disabled")})}),this},disableButtons:function(b){var c=this.__parseButtonNameParam(b),d=this;return a.each(c,function(a){d.__alterButtons(c[a],function(a){a.attr("disabled","disabled")})}),this},hideButtons:function(b){var c=this.__parseButtonNameParam(b),d=this;return a.each(c,function(a){d.__alterButtons(c[a],function(a){a.addClass("hidden")})}),this},showButtons:function(b){var c=this.__parseButtonNameParam(b),d=this;return a.each(c,function(a){d.__alterButtons(c[a],function(a){a.removeClass("hidden")})}),this},eventSupported:function(a){var b=a in this.$element;return b||(this.$element.setAttribute(a,"return;"),b="function"==typeof this.$element[a]),b},keyup:function(a){var b=!1;switch(a.keyCode){case 40:case 38:case 16:case 17:case 18:break;case 9:var c;if(c=this.getNextTab(),null!=c){var d=this;setTimeout(function(){d.setSelection(c.start,c.end)},500),b=!0}else{var e=this.getSelection();e.start==e.end&&e.end==this.getContent().length?b=!1:(this.setSelection(this.getContent().length,this.getContent().length),b=!0)}break;case 13:b=!1;break;case 27:this.$isFullscreen&&this.setFullscreen(!1),b=!1;break;default:b=!1}b&&(a.stopPropagation(),a.preventDefault()),this.$options.onChange(this)},change:function(){return this.$options.onChange(this),this},focus:function(){var c=this.$options,e=(c.hideable,this.$editor);return e.addClass("active"),a(document).find(".md-editor").each(function(){if(a(this).attr("id")!=e.attr("id")){var b;b=a(this).find("textarea").data("markdown"),null==b&&(b=a(this).find('div[data-provider="markdown-preview"]').data("markdown")),b&&b.blur()}}),c.onFocus(this),this},blur:function(){var c=this.$options,d=c.hideable,e=this.$editor,f=this.$editable;if(e.hasClass("active")||0==this.$element.parent().length){if(e.removeClass("active"),d)if(null!=f.el){var g=a("<"+f.type+"/>"),h=this.getContent(),i="object"==typeof markdown?markdown.toHTML(h):h;a(f.attrKeys).each(function(a){g.attr(f.attrKeys[a],f.attrValues[a])}),g.html(i),e.replaceWith(g)}else e.hide();c.onBlur(this)}return this}};var c=a.fn.markdown;a.fn.markdown=function(c){return this.each(function(){var d=a(this),e=d.data("markdown"),f="object"==typeof c&&c;e||d.data("markdown",e=new b(this,f))})},a.fn.markdown.messages={},a.fn.markdown.defaults={autofocus:!1,hideable:!1,savable:!1,width:"inherit",height:"inherit",resize:"none",iconlibrary:"glyph",language:"en",initialstate:"editor",buttons:[[{name:"groupFont",data:[{name:"cmdBold",hotkey:"Ctrl+B",title:"Bold",icon:{glyph:"glyphicon glyphicon-bold",fa:"fa fa-bold","fa-3":"icon-bold"},callback:function(a){var b,c,d=a.getSelection(),e=a.getContent();b=0==d.length?a.__localize("strong text"):d.text,"**"==e.substr(d.start-2,2)&&"**"==e.substr(d.end,2)?(a.setSelection(d.start-2,d.end+2),a.replaceSelection(b),c=d.start-2):(a.replaceSelection("**"+b+"**"),c=d.start+2),a.setSelection(c,c+b.length)}},{name:"cmdItalic",title:"Italic",hotkey:"Ctrl+I",icon:{glyph:"glyphicon glyphicon-italic",fa:"fa fa-italic","fa-3":"icon-italic"},callback:function(a){var b,c,d=a.getSelection(),e=a.getContent();b=0==d.length?a.__localize("emphasized text"):d.text,"_"==e.substr(d.start-1,1)&&"_"==e.substr(d.end,1)?(a.setSelection(d.start-1,d.end+1),a.replaceSelection(b),c=d.start-1):(a.replaceSelection("_"+b+"_"),c=d.start+1),a.setSelection(c,c+b.length)}},{name:"cmdHeading",title:"Heading",hotkey:"Ctrl+H",icon:{glyph:"glyphicon glyphicon-header",fa:"fa fa-font","fa-3":"icon-font"},callback:function(a){var b,c,f,g,d=a.getSelection(),e=a.getContent();b=0==d.length?a.__localize("heading text"):d.text+"\n",f=4,"### "==e.substr(d.start-f,f)||(f=3,"###"==e.substr(d.start-f,f))?(a.setSelection(d.start-f,d.end),a.replaceSelection(b),c=d.start-f):d.start>0&&(g=e.substr(d.start-1,1),!!g&&"\n"!=g)?(a.replaceSelection("\n\n### "+b),c=d.start+6):(a.replaceSelection("### "+b),c=d.start+4),a.setSelection(c,c+b.length)}}]},{name:"groupLink",data:[{name:"cmdUrl",title:"URL/Link",hotkey:"Ctrl+L",icon:{glyph:"glyphicon glyphicon-link",fa:"fa fa-link","fa-3":"icon-link"},callback:function(b){var c,d,g,e=b.getSelection();if(b.getContent(),c=0==e.length?b.__localize("enter link description here"):e.text,g=prompt(b.__localize("Insert Hyperlink"),"http://"),null!=g&&""!=g&&"http://"!=g&&"http"==g.substr(0,4)){var h=a("<div>"+g+"</div>").text();b.replaceSelection("["+c+"]("+h+")"),d=e.start+1,b.setSelection(d,d+c.length)}}},{name:"cmdImage",title:"Image",hotkey:"Ctrl+G",icon:{glyph:"glyphicon glyphicon-picture",fa:"fa fa-picture-o","fa-3":"icon-picture"},callback:function(b){var c,d,g,e=b.getSelection();if(b.getContent(),c=0==e.length?b.__localize("enter image description here"):e.text,g=prompt(b.__localize("Insert Image Hyperlink"),"http://"),null!=g&&""!=g&&"http://"!=g&&"http"==g.substr(0,4)){var h=a("<div>"+g+"</div>").text();b.replaceSelection("!["+c+"]("+h+' "'+b.__localize("enter image title here")+'")'),d=e.start+2,b.setNextTab(b.__localize("enter image title here")),b.setSelection(d,d+c.length)}}}]},{name:"groupMisc",data:[{name:"cmdList",hotkey:"Ctrl+U",title:"Unordered List",icon:{glyph:"glyphicon glyphicon-list",fa:"fa fa-list","fa-3":"icon-list-ul"},callback:function(b){var c,d,e=b.getSelection();if(b.getContent(),0==e.length)c=b.__localize("list text here"),b.replaceSelection("- "+c),d=e.start+2;else if(e.text.indexOf("\n")<0)c=e.text,b.replaceSelection("- "+c),d=e.start+2;else{var g=[];g=e.text.split("\n"),c=g[0],a.each(g,function(a,b){g[a]="- "+b}),b.replaceSelection("\n\n"+g.join("\n")),d=e.start+4}b.setSelection(d,d+c.length)}},{name:"cmdListO",hotkey:"Ctrl+O",title:"Ordered List",icon:{glyph:"glyphicon glyphicon-th-list",fa:"fa fa-list-ol","fa-3":"icon-list-ol"},callback:function(b){var c,d,e=b.getSelection();if(b.getContent(),0==e.length)c=b.__localize("list text here"),b.replaceSelection("1. "+c),d=e.start+3;else if(e.text.indexOf("\n")<0)c=e.text,b.replaceSelection("1. "+c),d=e.start+3;else{var g=[];g=e.text.split("\n"),c=g[0],a.each(g,function(a,b){g[a]="1. "+b}),b.replaceSelection("\n\n"+g.join("\n")),d=e.start+5}b.setSelection(d,d+c.length)}},{name:"cmdCode",hotkey:"Ctrl+K",title:"Code",icon:{glyph:"glyphicon glyphicon-asterisk",fa:"fa fa-code","fa-3":"icon-code"},callback:function(a){var b,c,d=a.getSelection(),e=a.getContent();b=0==d.length?a.__localize("code text here"):d.text,"`"==e.substr(d.start-1,1)&&"`"==e.substr(d.end,1)?(a.setSelection(d.start-1,d.end+1),a.replaceSelection(b),c=d.start-1):(a.replaceSelection("`"+b+"`"),c=d.start+1),a.setSelection(c,c+b.length)}},{name:"cmdQuote",hotkey:"Ctrl+Q",title:"Quote",icon:{glyph:"glyphicon glyphicon-comment",fa:"fa fa-quote-left","fa-3":"icon-quote-left"},callback:function(b){var c,d,e=b.getSelection();if(b.getContent(),0==e.length)c=b.__localize("quote here"),b.replaceSelection("> "+c),d=e.start+2;else if(e.text.indexOf("\n")<0)c=e.text,b.replaceSelection("> "+c),d=e.start+2;else{var g=[];g=e.text.split("\n"),c=g[0],a.each(g,function(a,b){g[a]="> "+b}),b.replaceSelection("\n\n"+g.join("\n")),d=e.start+4}b.setSelection(d,d+c.length)}}]},{name:"groupUtil",data:[{name:"cmdPreview",toggle:!0,hotkey:"Ctrl+P",title:"Preview",btnText:"Preview",btnClass:"btn btn-primary btn-sm",icon:{glyph:"glyphicon glyphicon-search",fa:"fa fa-search","fa-3":"icon-search"},callback:function(a){var b=a.$isPreview;0==b?a.showPreview():a.hidePreview()}}]}]],additionalButtons:[],reorderButtonGroups:[],hiddenButtons:[],disabledButtons:[],footer:"",fullscreen:{enable:!0,icons:{fullscreenOn:{fa:"fa fa-expand",glyph:"glyphicon glyphicon-fullscreen","fa-3":"icon-resize-full"},fullscreenOff:{fa:"fa fa-compress",glyph:"glyphicon glyphicon-fullscreen","fa-3":"icon-resize-small"}}},onShow:function(){},onPreview:function(){},onSave:function(){},onBlur:function(){},onFocus:function(){},onChange:function(){},onFullscreen:function(){}},a.fn.markdown.Constructor=b,a.fn.markdown.noConflict=function(){return a.fn.markdown=c,this};var d=function(a){var b=a;return b.data("markdown")?(b.data("markdown").showEditor(),void 0):(b.markdown(),void 0)},e=function(){var c=a(document.activeElement);a(document).find(".md-editor").each(function(){var b=a(this),d=c.closest(".md-editor")[0]===this,e=b.find("textarea").data("markdown")||b.find('div[data-provider="markdown-preview"]').data("markdown");e&&!d&&e.blur()})};a(document).on("click.markdown.data-api",'[data-provide="markdown-editable"]',function(b){d(a(this)),b.preventDefault()}).on("click focusin",function(a){e(a)}).ready(function(){a('textarea[data-provide="markdown"]').each(function(){d(a(this))})})}(window.jQuery);