!function(a){var b=function(b,c){this.$element=a(b),this.options=a.extend({},a.fn.clockface.defaults,c,this.$element.data()),this.init()};b.prototype={constructor:b,init:function(){this.$clockface=a(a.fn.clockface.template),this.$clockface.find(".l1 .cell, .left.cell").html('<div class="outer"></div><div class="inner"></div>'),this.$clockface.find(".l5 .cell, .right.cell").html('<div class="inner"></div><div class="outer"></div>'),this.$clockface.hide(),this.$outer=this.$clockface.find(".outer"),this.$inner=this.$clockface.find(".inner"),this.$ampm=this.$clockface.find(".ampm"),this.ampm=null,this.hour=null,this.minute=null,this.$ampm.click(a.proxy(this.clickAmPm,this)),this.$clockface.on("click",".cell",a.proxy(this.click,this)),this.parseFormat(),this.prepareRegexp(),this.ampmtext=this.is24?{am:"12-23",pm:"0-11"}:{am:"AM",pm:"PM"},this.isInline=this.$element.is("div"),this.isInline?this.$clockface.addClass("clockface-inline").appendTo(this.$element):(this.$clockface.addClass("dropdown-menu").appendTo("body"),"focus"===this.options.trigger&&this.$element.on("focus.clockface",a.proxy(function(){this.show()},this)),a(document).off("click.clockface").on("click.clockface",a.proxy(function(b){var c=a(b.target);c.closest(".clockface").length||a(".clockface-open").each(function(){this!==b.target&&a(this).clockface("hide")})},this))),this.fill("minute")},show:function(b){this.$clockface.is(":visible")||(this.isInline||(void 0===b&&(b=this.$element.val()),this.$element.addClass("clockface-open"),this.$element.on("keydown.clockface",a.proxy(this.keydown,this)),this.place(),a(window).on("resize.clockface",a.proxy(this.place,this))),this.$clockface.show(),this.setTime(b),this.$element.triggerHandler("shown.clockface",this.getTime(!0)))},hide:function(){this.$clockface.hide(),this.isInline||(this.$element.removeClass("clockface-open"),this.$element.off("keydown.clockface"),a(window).off("resize.clockface")),this.$element.triggerHandler("hidden.clockface",this.getTime(!0))},toggle:function(a){this.$clockface.is(":visible")?this.hide():this.show(a)},setTime:function(a){var b,c,d,e="am";return void 0===a?(null===this.ampm&&this.setAmPm("am"),void 0):(a instanceof Date&&(c=a.getHours(),d=a.getMinutes()),"string"==typeof a&&a.length&&(b=this.parseTime(a),24===b.hour&&(b.hour=0),c=b.hour,d=b.minute,e=b.ampm),c>11&&24>c?(e="pm",!this.is24&&c>12&&(c-=12)):c>=0&&11>c&&(this.is24||0===c)&&(e="am"),this.setAmPm(e),this.setHour(c),this.setMinute(d),void 0)},setAmPm:function(a){a!==this.ampm&&(this.ampm="am"===a?"am":"pm",this.$ampm.text(this.ampmtext[this.ampm]),this.fill("hour"),this.highlight("hour"))},setHour:function(a){a=parseInt(a,10),a=isNaN(a)?null:a,(0>a||a>23)&&(a=null),a!==this.hour&&(this.hour=a,this.highlight("hour"))},setMinute:function(a){a=parseInt(a,10),a=isNaN(a)?null:a,(0>a||a>59)&&(a=null),a!==this.minute&&(this.minute=a,this.highlight("minute"))},highlight:function(b){var c,d=this.getValues(b),e="minute"===b?this.minute:this.hour,f="minute"===b?this.$outer:this.$inner;f.removeClass("active"),c=a.inArray(e,d),c>=0&&f.eq(c).addClass("active")},fill:function(b){var c=this.getValues(b),d="minute"===b?this.$outer:this.$inner,e="minute"===b;d.each(function(b){var d=c[b];e&&10>d&&(d="0"+d),a(this).text(d)})},getValues:function(b){var c=[11,0,1,10,2,9,3,8,4,7,6,5],d=c.slice();return"minute"===b?a.each(c,function(a,b){d[a]=5*b}):(this.is24||(d[1]=12),this.is24&&"pm"===this.ampm&&a.each(c,function(a,b){d[a]=b+12})),d},click:function(b){var c=a(b.target),d=c.hasClass("active")?null:c.text();c.hasClass("inner")?this.setHour(d):this.setMinute(d),this.isInline||this.$element.val(this.getTime()),this.$element.triggerHandler("pick.clockface",this.getTime(!0))},clickAmPm:function(a){a.preventDefault(),this.setAmPm("am"===this.ampm?"pm":"am"),this.isInline||this.is24||this.$element.val(this.getTime()),this.$element.triggerHandler("pick.clockface",this.getTime(!0))},place:function(){var b=parseInt(this.$element.parents().filter(function(){return"auto"!=a(this).css("z-index")}).first().css("z-index"),10)+10,c=this.$element.offset();this.$clockface.css({top:c.top+this.$element.outerHeight(),left:c.left,zIndex:b})},keydown:function(b){return/^(9|27|13)$/.test(b.which)?(this.hide(),void 0):(clearTimeout(this.timer),this.timer=setTimeout(a.proxy(function(){this.setTime(this.$element.val())},this),500),void 0)},parseFormat:function(){var b=this.options.format,c="HH",d="mm";a.each(["HH","hh","H","h"],function(a,d){return-1!==b.indexOf(d)?(c=d,!1):void 0}),a.each(["mm","m"],function(a,c){return-1!==b.indexOf(c)?(d=c,!1):void 0}),this.is24=-1!==c.indexOf("H"),this.hFormat=c,this.mFormat=d},parseTime:function(b){var g,c=null,d=null,e="am",f=[];if(b=a.trim(b),this.regexpSep&&(f=b.match(this.regexpSep)),f&&f.length)c=f[1]?parseInt(f[1],10):null,d=f[2]?parseInt(f[2],10):null,e=f[3]&&"a"!==f[3].toLowerCase()?"pm":"am";else if(b=b.split("").reverse().join("").replace(/\s/g,""),f=b.match(this.regexpNoSep),f&&f.length)switch(e=f[1]&&"a"!==f[1].toLowerCase()?"pm":"am",g=f[2].split("").reverse().join(""),g.length){case 1:c=parseInt(g,10);break;case 2:c=parseInt(g,10),c>24&&(c=parseInt(g[0],10),d=parseInt(g[1],10));break;case 3:c=parseInt(g[0],10),d=parseInt(g[1]+g[2],10),d>59&&(c=parseInt(g[0]+g[1],10),d=parseInt(g[2],10),c>24&&(c=null,d=null));break;case 4:c=parseInt(g[0]+g[1],10),d=parseInt(g[2]+g[3],10),c>24&&(c=null),d>59&&(d=null)}return{hour:c,minute:d,ampm:e}},prepareRegexp:function(){var a=this.options.format.match(/h\s*([^hm]?)\s*m/i);a&&a.length&&(a=a[1]),this.separator=a,this.regexpSep=this.separator&&this.separator.length?new RegExp("(\\d\\d?)\\s*\\"+this.separator+"\\s*(\\d?\\d?)\\s*(a|p)?","i"):null,this.regexpNoSep=new RegExp("(a|p)?\\s*(\\d{1,4})","i")},getTime:function(a){if(a===!0)return{hour:this.hour,minute:this.minute,ampm:this.ampm};var b=null!==this.hour?this.hour+"":"",c=null!==this.minute?this.minute+"":"",d=this.options.format;return b.length||c.length?(this.hFormat.length>1&&1===b.length&&(b="0"+b),this.mFormat.length>1&&1===c.length&&(c="0"+c),!c.length&&this.separator&&(d=d.replace(this.separator,"")),d=d.replace(this.hFormat,b).replace(this.mFormat,c),this.is24||(d=-1!==d.indexOf("A")?d.replace("A",this.ampm.toUpperCase()):d.replace("a",this.ampm)),d):""},destroy:function(){this.hide(),this.$clockface.remove(),this.isInline||"focus"!==this.options.trigger||this.$element.off("focus.clockface")}},a.fn.clockface=function(c){var d,e=Array.apply(null,arguments);return e.shift(),"getTime"===c&&this.length&&(d=this.eq(0).data("clockface"))?d.getTime.apply(d,e):this.each(function(){var d=a(this),f=d.data("clockface"),g="object"==typeof c&&c;f||d.data("clockface",f=new b(this,g)),"string"==typeof c&&"function"==typeof f[c]&&f[c].apply(f,e)})},a.fn.clockface.defaults={format:"H:mm",trigger:"focus"},a.fn.clockface.template='<div class="clockface"><div class="l1"><div class="cell"></div><div class="cell"></div><div class="cell"></div></div><div class="l2"><div class="cell left"></div><div class="cell right"></div></div><div class="l3"><div class="cell left"></div><div class="cell right"></div><div class="center"><a href="#" class="ampm"></a></div></div><div class="l4"><div class="cell left"></div><div class="cell right"></div></div><div class="l5"><div class="cell"></div><div class="cell"></div><div class="cell"></div></div></div>'}(window.jQuery);