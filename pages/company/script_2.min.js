page_script({init:function(){$.fn.editable.defaults.ajaxOptions={type:"POST"};$.fn.editable.defaults.type="text";$.fn.editable.defaults.pk=1;$.fn.editable.defaults.mode="inline";$.fn.editable.defaults.inputclass="form-control";$.fn.editable.defaults.url=location.href;$.fn.editable.defaults.onblur="submit";$.fn.editable.defaults.emptytext="Vide";$(".editable").editable({params:function(o){o.element="company";return o}});if($(".categories-editable").length>0){$(".categories-editable").editable({mode:"popup",inputclass:"input-medium",params:function(o){o.element="company";return o},select2:{multiple:true},source:JSON.parse($(".categories-editable").attr("data-available"))})}$(".seat_editable").editable({params:function(o){o.element="seat";return o}});$(".product_editable").editable({mode:"popup",params:function(o){o.element="product";return o}});var d=[];var l=function(r){var p=JSON.parse($("input[name=available_product_categories]").val());Array.prototype.push.apply(p,d);if(r){for(var o=0;o<p.length;o++){if(p.hasOwnProperty(o)&&p[o].text.indexOf(r)==-1){p.splice(o,1);if(o||p.length){o--}}}}return p};$(".product_categories_editable").editable({mode:"popup",params:function(o){o.element="product";return o},source:l(),display:function(r,q){var o=[],p=$.fn.editableutils.itemsByValue(r,l(),"id");if(p.length){$.each(p,function(t,s){o.push($.fn.editableutils.escape(s.text))});$(this).html(o.join(", "))}else{$(this).empty()}},select2:{multiple:true,query:function(o){o.callback({results:l(o.term)})}}});$(".service_editable").editable({mode:"popup",params:function(o){o.element="service";return o}});var h=[];var b=function(r){var p=JSON.parse($("input[name=available_service_categories]").val());Array.prototype.push.apply(p,h);if(r){for(var o=0;o<p.length;o++){if(p.hasOwnProperty(o)&&p[o].text.indexOf(r)==-1){p.splice(o,1);if(o||p.length){o--}}}}return p};$(".service_categories_editable").editable({mode:"popup",params:function(o){o.element="service";return o},source:b(),display:function(r,q){var o=[],p=$.fn.editableutils.itemsByValue(r,b(),"id");if(p.length){$.each(p,function(t,s){o.push($.fn.editableutils.escape(s.text))});$(this).html(o.join(", "))}else{$(this).empty()}},select2:{multiple:true,query:function(o){o.callback({results:b(o.term)})},formatSelection:function(o){console.log(o);return o.text}}});$(".new_service").click(function(o){$.ajax({url:location.href,type:"POST",data:{new_service:true},success:function(q){try{var t=JSON.parse(q);switch(t.status){case"success":var s=$("#new_service_template").clone();s.removeAttr("id");s.prependTo("#services_list").show();s.attr("data-id",t.id);$(".service_editable",s).attr("data-pk",t.id).editable({value:null,mode:"popup",params:function(u){u.element="service";return u}});$(".service_categories_editable",s).attr("data-pk",t.id).editable({value:[],mode:"popup",params:function(u){u.element="service";return u},source:JSON.parse($("input[name=available_service_categories]").val()),select2:{multiple:true}});$(".delete",s).click(function(p){n(p,this)});$("input[type=file]",s).change(function(p){i(p,this)});$(".price_checkbox",s).change(j);$(".rent_price_checkbox",s).change(c);$(".fb-like",s).attr("data-href",t.url);$("[href='#services_list']").click();$($(".thumbnail",s)[0]).pulsate({color:"#399bc3",repeat:2});break;default:console.log(q);break}}catch(r){console.log(q)}},error:function(p){console.log(p)}})});$(".new_product").click(function(o){$.ajax({url:location.href,type:"POST",data:{new_product:true},success:function(q){try{var t=JSON.parse(q);switch(t.status){case"success":var s=$("#new_product_template").clone();s.removeAttr("id");s.prependTo("#products_list").show();s.attr("data-id",t.id);$(".product_editable",s).attr("data-pk",t.id).editable({value:null,mode:"popup",params:function(u){u.element="product";return u}});$(".product_categories_editable",s).attr("data-pk",t.id).editable({value:[],mode:"popup",params:function(u){u.element="product";return u},source:JSON.parse($("input[name=available_product_categories]").val()),select2:{multiple:true}});$(".delete",s).click(function(p){m(p,this)});$("input[type=file]",s).change(function(p){k(p,this)});$(".price_checkbox",s).change(j);$(".rent_price_checkbox",s).change(c);$(".fb-like",s).attr("data-href",t.url);$("[href='#products_list']").click();$($(".thumbnail",s)[0]).pulsate({color:"#399bc3",repeat:2});break;default:console.log(q);break}}catch(r){console.log(q)}},error:function(p){console.log(p)}})});var j=function(r){var o=$(this).parents("p");var p=$("[data-name=price]",o);var q=$(".unit",o);if($(this).prop("checked")){p.editable("enable");q.show()}else{$.post(location.href,{element:(p.hasClass("product_editable")?"product":"service"),pk:p.attr("data-pk"),name:"price",value:null},function(s){p.editable("setValue",null).editable("submit").editable("disable");q.hide()})}};var c=function(r){var o=$(this).parents("p");var p=$("[data-name=rent_price]",o);var q=$(".unit",o);if($(this).prop("checked")){p.editable("enable");q.show()}else{$.post(location.href,{element:(p.hasClass("product_editable")?"product":"service"),pk:p.attr("data-pk"),name:"rent_price",value:null},function(s){p.editable("setValue",null).editable("submit").editable("disable");q.hide()})}};$(".price_checkbox").change(j);$(".rent_price_checkbox").change(c);var m=function(q,p){q.preventDefault();var o=$(p).parents(".product");$.ajax({url:location.href,type:"POST",data:{delete_product:o.attr("data-id")},success:function(r){try{var t=JSON.parse(r);switch(t.status){case"success":o.remove();break;default:console.log(r);break}}catch(s){console.log(r)}},error:function(r){console.log(r)}})};var n=function(q,p){q.preventDefault();var o=$(p).parents(".service");$.ajax({url:location.href,type:"POST",data:{delete_service:o.attr("data-id")},success:function(r){try{var t=JSON.parse(r);switch(t.status){case"success":o.remove();break;default:console.log(r);break}}catch(s){console.log(r)}},error:function(r){console.log(r)}})};$(".service .delete").click(function(o){n(o,this)});$(".product .delete").click(function(o){m(o,this)});var k=function(r,o){if(o.files.length==0){return}var q=$(".product form");var p=new FormData(q[0]);p.append("file","product_image");p.append("pk",$(o).parents(".product").attr("data-id"));$.ajax({url:location.href,type:"POST",data:p,enctype:"multipart/form-data",processData:false,contentType:false,success:function(s){if(s!="success"){console.log(s)}},error:function(s){console.log(s)}})};var i=function(r,o){if(o.files.length==0){return}var q=$(".service form");var p=new FormData(q[0]);p.append("file","service_image");p.append("pk",$(o).parents(".service").attr("data-id"));$.ajax({url:location.href,type:"POST",data:p,enctype:"multipart/form-data",processData:false,contentType:false,success:function(s){if(s!="success"){console.log(s)}},error:function(s){console.log(s)}})};$(".service input[type=file]").change(function(o){i(o,this)});$(".product input[type=file]").change(function(o){k(o,this)});$(".logo input[type=file]").change(function(q){if(this.files.length==0){return}var p=$(".logo form");var o=new FormData(p[0]);o.append("file","logo");$.ajax({url:location.href,type:"POST",data:o,enctype:"multipart/form-data",processData:false,contentType:false,success:function(r){if(r!="success"){console.log(r)}},error:function(r){console.log(r)}})});$(".cover input[type=file]").change(function(q){if(this.files.length==0){return}var p=$(".cover form");var o=new FormData(p[0]);o.append("file","cover");$.ajax({url:location.href,type:"POST",data:o,enctype:"multipart/form-data",processData:false,contentType:false,success:function(r){if(r!="success"){console.log(r)}},error:function(r){console.log(r)}})});var a=$(".map_container .map-canvas");var f=new google.maps.LatLng(a.attr("data-latitude"),a.attr("data-longitude"));var e={scrollwheel:false,zoom:13,center:f};var a=new google.maps.Map(a[0],e);var g=new google.maps.Marker({position:f});g.setMap(a);$("#map_modal").on("shown.bs.modal",function(o){$("#map_modal .map-canvas").each(function(){$(this).locationpicker({location:{latitude:$(this).attr("data-latitude"),longitude:$(this).attr("data-longitude")},radius:0,zoom:12,enableAutocomplete:true,scrollwheel:true,onchanged:function(r,p,q){$.ajax({url:location.href,type:"POST",data:{geolocation:$(this).attr("data-pk"),latitude:r.latitude,longitude:r.longitude},success:function(u){try{if(u=="success"){$(".map-canvas").attr("data-latitude",r.latitude);$(".map-canvas").attr("data-longitude",r.longitude);var x=$(".map_container .map-canvas");var t=new google.maps.LatLng(x.attr("data-latitude"),x.attr("data-longitude"));var v={scrollwheel:false,zoom:13,center:t};var x=new google.maps.Map(x[0],v);var s=new google.maps.Marker({position:t});s.setMap(x)}else{console.log(u)}}catch(w){console.log(u)}},error:function(s){console.log(s)}})}})})});$(".transform_job").click(function(){if(!confirm("Etes vous sûr ?")){return false}$.post(location.href,{transform:"job"},function(o){try{if(o=="success"){app.ajaxify(location.href)}else{console.log(o)}}catch(p){console.log(o)}})});$(".transform_shop").click(function(){if(!confirm("Etes vous sûr ?")){return false}$.post(location.href,{transform:"shop"},function(o){try{if(o=="success"){app.ajaxify(location.href)}else{console.log(o)}}catch(p){console.log(o)}})});$(".delete_page").click(function(){if(!confirm($(this).attr("data-confirm")+$('.profile-usertitle-name a[data-name="name"]').text())){return false}$.post(location.href,{remove_me:true},function(o){try{if(o=="success"){app.ajaxify("/account")}else{console.log(o)}}catch(p){console.log(o)}})});if($(".messages .badge").length){$(".messages").pulsate({color:"#e91e63",repeat:3})}$(".ticket .cancel_password_reset_ticket").live("click",function(o){console.log("ok");$.post(location.href,{cancel_password_reset_ticket:true},function(p){console.log(p);try{var q=JSON.parse(p);if(q.status=="success"){$(".ticket").hide();$(".new_ticket").show();$(".ticket .token").text("")}else{console.log(p)}}catch(r){console.log(p)}})});$(".new_ticket .new_password_reset_ticket").live("click",function(o){console.log("ok");$.post(location.href,{new_password_reset_ticket:true},function(p){console.log(p);try{var q=JSON.parse(p);if(q.status=="success"){$(".ticket .token").text(q.params.token);$(".new_ticket").hide();$(".ticket").show()}else{console.log(p)}}catch(r){console.log(p)}})});$("#add_category_form").ajaxForm({success:function(o){try{parsed=JSON.parse(o);if(parsed.status=="success"){d.push({id:parsed.params.id,text:parsed.params.text});h.push({id:parsed.params.id,text:parsed.params.text});$("#add_category_modal").modal("hide")}else{console.log(o)}}catch(p){console.log(o)}}});$("#add_category_form").on("hide.bs.modal",function(){$("#add_category_form")[0].reset()});$(".clear_value").live("click",function(){$($(this).parent()[0]).children('[data-name="categories"]').editable("setValue",[])})}});