page_script({init:function(){var a=[];$("[data-folder]").click(function(d,b){var c=$(this).attr("data-folder");$.get(location.href,{refresh:c},function(f){try{var g=JSON.parse(f);if(g.status="success"){var h=$(".messages-list tbody");h.empty();if(g.messages.length){a=g.messages;for(var j=0;j<g.messages.length;j++){var k=$("<tr>",{"data-id":j,"class":(g.messages[j].unread?"unread":"")}).append([$("<td>",{text:g.messages[j].subject}),$("<td>",{text:g.messages[j].from}),$("<td>",{text:g.messages[j].date}),]);h.append(k)}$(".messages-list .empty-msg").hide();$(".messages-list table").show()}else{$(".messages-list .empty-msg").show();$(".messages-list table").hide()}if(!b){$(".messages-list").show();$(".message-details").hide();$(".message-details iframe").attr("src","")}}else{console.log(f)}}catch(l){console.log(f)}})});$(".messages-list tbody tr").live("click",function(){var c=a[$(this).attr("data-id")];$(".message-details").attr("data-id",c.id);$(".message-details .from").text(c.from);$(".message-details .to").text(c.to);$(".message-details .reply_to").text(c.reply_to);$(".message-details .subject").text(c.subject);$(".message-details .date").text(c.date);var d=$(".message-details .attachments .list");d.empty();if(c.attachments){for(var b=0;b<c.attachments.length;b++){d.append($("<a>",{"class":"btn btn-flat btn-lg",href:"messages/"+$(".folders .active a").attr("data-folder")+"/"+c.uid+"/"+b,html:'<i class="fa fa-download"></i> '+c.attachments[b].name}))}$(".message-details .attachments").show()}else{$(".message-details .attachments").hide()}$(".message-details iframe").attr("src","messages/"+$(".folders .active a").attr("data-folder")+"/"+c.uid);$(this).removeClass("unread");$(".messages-list").hide();$(".message-details").show()});$(".back_to_list").click(function(){$(".messages-list").show();$(".message-details").hide();$(".message-details iframe").attr("src","")});$(".message-details .delete").click(function(){$.post(location.href,{remove_message:$(".message-details").attr("data-id"),folder:$(".folders .active a").attr("data-folder")},function(b){try{parsed=JSON.parse(b);if(parsed.status=="success"){$(".folders .active a").trigger("click")}else{console.log(b)}}catch(c){console.log(b)}})});$(".message-details .reply").click(function(){$("#message_form [name=email]").val($(".message-details .reply_to").text().substring($(".message-details .reply_to").text().indexOf("<")+1,$(".message-details .reply_to").text().indexOf(">"))+";");$("#message_form [name=subject]").val("Re: "+$(".message-details .subject").text());$("#message_modal").modal("show")});CKEDITOR.replace("message");CKEDITOR.instances.message.on("change",function(){CKEDITOR.instances.message.updateElement()});$("#message_form").ajaxForm({beforeSubmit:function(){$(".btn-loader",$("#message_modal")).show();$(".success_msg",$("#message_form")).hide();$(".unhandled_error",$("#message_form")).hide()},success:function(b){$(".btn-loader",$("#message_modal")).hide();try{parsed=JSON.parse(b);if(parsed.status=="success"){$(".success_msg",$("#message_form")).show();$("#message_form")[0].reset()}else{console.log(b);$(".unhandled_error",$("#message_form")).show()}}catch(c){console.log(b);$(".unhandled_error",$("#message_form")).show()}}});$("#message_modal").on("hide.bs.modal",function(){$("#message_form")[0].reset();$(".success_msg",$("#message_form")).hide();$(".unhandled_error",$("#message_form")).hide()});$(".folders .active a").trigger("click");setInterval(function(){$(".folders .active a").trigger("click",[true])},60000)}});