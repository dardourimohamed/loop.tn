page_script({init:function(){var f=$("#title"+$("input[name=type]:checked").val()+" form");$("input[name=type]").change(function(){switch($("input[name=type]:checked").val()){case"1":$('a[href="#title1"]').tab("show");f=$("#title1 form");var h=$("#job_geolocation").locationpicker("map");google.maps.event.trigger(h.map,"resize");h.map.setCenter(h.marker.position);break;case"3":$('a[href="#title3"]').tab("show");f=$("#title3 form");var h=$("#company_geolocation").locationpicker("map");google.maps.event.trigger(h.map,"resize");h.map.setCenter(h.marker.position);break}});$("#register_form input[name=username]").change(function(){var h=$(this);$(".icon-check, .icon-ban, .icon-close",h.closest(".form-group")).remove();if(h.val()===""){h.closest(".form-group").removeClass("has-error").removeClass("has-success");return}h.attr("readonly",true).attr("disabled",true).addClass("spinner");$("#username_unvailable_msg").hide();$("#username_error_msg").hide();$.post($("#register_form").attr("action"),{check_username:h.val()},function(i){h.attr("readonly",false).attr("disabled",false).removeClass("spinner");if(i.status=="available"){$(".icon-ban",h.closest(".form-group")).remove();h.closest(".form-group").removeClass("has-error").removeClass("has-success")}else{if(i.status=="not_available"){h.closest(".form-group").removeClass("has-success").addClass("has-error");$(".fa-check",h.closest(".form-group")).remove();h.before('<i class="icon-ban"></i>');$("#username_unvailable_msg").show();h.focus()}else{console.log(i);h.closest(".form-group").removeClass("has-success").addClass("has-error");$(".fa-check",h.closest(".form-group")).remove();h.before('<i class="icon-close"></i>');$("#username_error_msg").show();$("#username_error_msg a").focus()}}},"json").fail(function(i){console.log(i);h.closest(".form-group").removeClass("has-success").addClass("has-error");$(".fa-check",h.closest(".form-group")).remove();h.before('<i class="icon-close"></i>');$("#username_error_msg").show();$("#username_error_msg a").focus()})});var d=function(){var h=$("#register_form input[name=password]");if($("#register_form input[name=password]").val().length<8){h.closest(".form-group").removeClass("has-success").addClass("has-error");$(".fa-check",h.closest(".form-group")).remove();h.before('<i class="icon-ban"></i>');$("#password_min_length_error").show();h.focus()}else{$(".icon-ban",h.closest(".form-group")).remove();h.closest(".form-group").removeClass("has-error").removeClass("has-success");$("#password_min_length_error").hide()}var h=$("#password_confirmation");if($("#password_confirmation").val()==""||$("#password_confirmation").val()==$("#register_form input[name=password]").val()){$(".icon-ban",h.closest(".form-group")).remove();h.closest(".form-group").removeClass("has-error").removeClass("has-success");$("#passwords_not_match").hide()}else{h.closest(".form-group").removeClass("has-success").addClass("has-error");$(".fa-check",$("#password_confirmation").closest(".form-group")).remove();h.before('<i class="icon-ban"></i>');$("#passwords_not_match").show();$("#password_confirmation").focus()}};$("#register_form input[name=password]").change(d);$("#password_confirmation").change(d);$("#register_form").ajaxForm({beforeSubmit:function(){if($("#password_confirmation").val()!=$("#register_form input[name=password]").val()){return false}},success:function(h){try{parsed=JSON.parse(h);if(parsed.status=="logged_in"){$(".top-menu .user-btn .username").text(parsed.params.displayname);$(".top-menu .login-btn").hide();$(".top-menu .user-btn").show();$("#register_form").remove();f.submit()}else{if(parsed.status=="username_exists"){var i=$("#register_form input[name=username]");i.closest(".form-group").removeClass("has-success").addClass("has-error");$(".fa-check",i.closest(".form-group")).remove();i.before('<i class="icon-ban"></i>');$("#username_unvailable_msg").show();i.focus()}else{if(parsed.status=="password_min_length_error"){var i=$("#register_form input[name=password]");i.closest(".form-group").removeClass("has-success").addClass("has-error");$(".fa-check",i.closest(".form-group")).remove();i.before('<i class="icon-ban"></i>');$("#password_min_length_error").show();i.focus()}else{console.log(h);$(".unhandled_error").show()}}}}catch(j){console.log(j);console.log(h);$(".unhandled_error").show()}},error:function(){console.log(rslt);$(".unhandled_error").show()}});if(!navigator.geolocation){var a=$("#job_find_my_position").parents(".input-group");a.before($("input",a));a.remove()}$("#job_geolocation").locationpicker({location:{latitude:33.881967,longitude:9.560764},radius:0,zoom:6,enableAutocomplete:true,scrollwheel:false,inputBinding:{locationNameInput:$("#job_submit_form [name=address]"),latitudeInput:$("#job_submit_form [name=latitude]"),longitudeInput:$("#job_submit_form [name=longitude]")}});$("#job_find_my_position").click(function(h){h.preventDefault();if(navigator.geolocation){navigator.geolocation.getCurrentPosition(function(i){$("#job_submit_form [name=latitude]").val(i.coords.latitude).change();$("#job_submit_form [name=longitude]").val(i.coords.longitude).change()})}});var e=$("#job_submit_form");var c=$(".alert-danger.form-error");var g=e.validate({ignore:"",errorElement:"span",errorClass:"help-block help-block-error",focusInvalid:true,rules:{name:{minlength:3,maxlength:255,required:true},description:{minlength:50,maxlength:4095,required:true},categories:{required:true},address:{required:true},longitude:{required:true},latitude:{required:true},tel:{required:true},email:{required:true}},invalidHandler:function(i,h){c.show()},highlight:function(h){$(h).closest(".form-group").removeClass("has-success").addClass("has-error")},unhighlight:function(h){$(h).closest(".form-group").removeClass("has-error")},success:function(h){},errorPlacement:function(h,i){switch($(i).attr("job_name")){default:h.insertAfter(i);break}},submitHandler:function(h){c.hide()}});$("[name='categories[]']",e).select2();e.submit(function(h){if(!e.valid()){h.preventDefault();return false}if(h.originalEvent&&$("#register_form").length==1){$("#register_form").submit();h.preventDefault();return false}$.ajax({url:$(this).attr("action"),type:"POST",data:$(e).serialize(),success:function(i){try{p=JSON.parse(i);switch(p.status){case"success":app.ajaxify(p.params.job_url);break;default:console.log(p);return false;break}}catch(j){console.log(i);return false}},error:function(i){console.log(i);return false}})});if(!navigator.geolocation){var a=$("#company_find_my_position").parents(".input-group");a.before($("input",a));a.remove()}$("#company_geolocation").locationpicker({location:{latitude:33.881967,longitude:9.560764},radius:0,zoom:6,enableAutocomplete:true,scrollwheel:false,inputBinding:{locationNameInput:$("#company_submit_form [name=address]"),latitudeInput:$("#company_submit_form [name=latitude]"),longitudeInput:$("#company_submit_form [name=longitude]")}});$("#company_find_my_position").click(function(h){h.preventDefault();if(navigator.geolocation){navigator.geolocation.getCurrentPosition(function(i){$("#company_submit_form [name=latitude]").val(i.coords.latitude).change();$("#company_submit_form [name=longitude]").val(i.coords.longitude).change()})}});var b=$("#company_submit_form");var c=$(".alert-danger.form-error");var g=b.validate({ignore:"",errorElement:"span",errorClass:"help-block help-block-error",focusInvalid:true,rules:{name:{minlength:3,maxlength:255,required:true},description:{minlength:50,maxlength:4095,required:true},categories:{required:true},url:{minlength:5,remote:{url:$("#register_form").attr("action"),type:"post",data:{check_url:function(){return $("[name=url]",company_).val()}}}},address:{required:true},longitude:{required:true},latitude:{required:true},tel:{required:true},email:{required:true}},invalidHandler:function(i,h){c.show()},highlight:function(h){$(h).closest(".form-group").removeClass("has-success").addClass("has-error")},unhighlight:function(h){$(h).closest(".form-group").removeClass("has-error")},success:function(h){},errorPlacement:function(h,i){switch($(i).attr("company_name")){case"url":h.appendTo($(i.parents(".form-group")[0]).find(".error_msg"));break;default:h.insertAfter(i);break}},submitHandler:function(h){c.hide()}});$("[name='categories[]']",b).select2();b.submit(function(h){if(!b.valid()){h.preventDefault();return false}if(h.originalEvent&&$("#register_form").length==1){$("#register_form").submit();h.preventDefault();return false}$.ajax({url:$(this).attr("action"),type:"POST",data:$(b).serialize(),success:function(i){try{p=JSON.parse(i);switch(p.status){case"success":app.ajaxify(p.params.company_url);break;default:console.log(p);return false;break}}catch(j){console.log(i);return false}},error:function(i){console.log(i);return false}})});$("#register_form input[name=displayname]").focus()}});