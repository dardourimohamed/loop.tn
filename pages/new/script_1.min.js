page_script({init:function(){var g=$("#title"+$("input[name=type]:checked").val()+" form");$("input[name=type]").change(function(){switch($("input[name=type]:checked").val()){case"1":$('a[href="#title1"]').tab("show");g=$("#title1 form");var i=$("#job_geolocation").locationpicker("map");google.maps.event.trigger(i.map,"resize");i.map.setCenter(i.marker.position);break;case"2":$('a[href="#title2"]').tab("show");g=$("#title3 form");var i=$("#shop_geolocation").locationpicker("map");google.maps.event.trigger(i.map,"resize");i.map.setCenter(i.marker.position);break;case"3":$('a[href="#title3"]').tab("show");g=$("#title3 form");var i=$("#company_geolocation").locationpicker("map");google.maps.event.trigger(i.map,"resize");i.map.setCenter(i.marker.position);break}});$("#register_form input[name=username]").change(function(){var i=$(this);$(".icon-check, .icon-ban, .icon-close",i.closest(".form-group")).remove();if(i.val()===""){i.closest(".form-group").removeClass("has-error").removeClass("has-success");return}i.attr("readonly",true).attr("disabled",true).addClass("spinner");$("#username_unvailable_msg").hide();$("#username_error_msg").hide();$.post($("#register_form").attr("action"),{check_username:i.val()},function(j){i.attr("readonly",false).attr("disabled",false).removeClass("spinner");if(j.status=="available"){$(".icon-ban",i.closest(".form-group")).remove();i.closest(".form-group").removeClass("has-error").removeClass("has-success")}else{if(j.status=="not_available"){i.closest(".form-group").removeClass("has-success").addClass("has-error");$(".fa-check",i.closest(".form-group")).remove();i.before('<i class="icon-ban"></i>');$("#username_unvailable_msg").show();i.focus()}else{console.log(j);i.closest(".form-group").removeClass("has-success").addClass("has-error");$(".fa-check",i.closest(".form-group")).remove();i.before('<i class="icon-close"></i>');$("#username_error_msg").show();$("#username_error_msg a").focus()}}},"json").fail(function(j){console.log(j);i.closest(".form-group").removeClass("has-success").addClass("has-error");$(".fa-check",i.closest(".form-group")).remove();i.before('<i class="icon-close"></i>');$("#username_error_msg").show();$("#username_error_msg a").focus()})});var e=function(){var i=$("#register_form input[name=password]");if($("#register_form input[name=password]").val().length<8){i.closest(".form-group").removeClass("has-success").addClass("has-error");$(".fa-check",i.closest(".form-group")).remove();i.before('<i class="icon-ban"></i>');$("#password_min_length_error").show();i.focus()}else{$(".icon-ban",i.closest(".form-group")).remove();i.closest(".form-group").removeClass("has-error").removeClass("has-success");$("#password_min_length_error").hide()}var i=$("#password_confirmation");if($("#password_confirmation").val()==""||$("#password_confirmation").val()==$("#register_form input[name=password]").val()){$(".icon-ban",i.closest(".form-group")).remove();i.closest(".form-group").removeClass("has-error").removeClass("has-success");$("#passwords_not_match").hide()}else{i.closest(".form-group").removeClass("has-success").addClass("has-error");$(".fa-check",$("#password_confirmation").closest(".form-group")).remove();i.before('<i class="icon-ban"></i>');$("#passwords_not_match").show();$("#password_confirmation").focus()}};$("#register_form input[name=password]").change(e);$("#password_confirmation").change(e);$("#register_form").ajaxForm({beforeSubmit:function(){if($("#password_confirmation").val()!=$("#register_form input[name=password]").val()){return false}},success:function(i){try{parsed=JSON.parse(i);if(parsed.status=="logged_in"){$(".top-menu .user-btn .username").text(parsed.params.displayname);$(".top-menu .login-btn").hide();$(".top-menu .user-btn").show();$("#register_form").remove();g.submit()}else{if(parsed.status=="username_exists"){var j=$("#register_form input[name=username]");j.closest(".form-group").removeClass("has-success").addClass("has-error");$(".fa-check",j.closest(".form-group")).remove();j.before('<i class="icon-ban"></i>');$("#username_unvailable_msg").show();j.focus()}else{if(parsed.status=="password_min_length_error"){var j=$("#register_form input[name=password]");j.closest(".form-group").removeClass("has-success").addClass("has-error");$(".fa-check",j.closest(".form-group")).remove();j.before('<i class="icon-ban"></i>');$("#password_min_length_error").show();j.focus()}else{console.log(i);$(".unhandled_error").show()}}}}catch(k){console.log(k);console.log(i);$(".unhandled_error").show()}},error:function(){console.log(rslt);$(".unhandled_error").show()}});if(!navigator.geolocation){var a=$("#job_find_my_position").parents(".input-group");a.before($("input",a));a.remove()}$("#job_geolocation").locationpicker({location:{latitude:33.881967,longitude:9.560764},radius:0,zoom:6,enableAutocomplete:true,scrollwheel:false,inputBinding:{locationNameInput:$("#job_submit_form [name=address]"),latitudeInput:$("#job_submit_form [name=latitude]"),longitudeInput:$("#job_submit_form [name=longitude]")}});$("#job_find_my_position").click(function(i){i.preventDefault();if(navigator.geolocation){navigator.geolocation.getCurrentPosition(function(j){$("#job_submit_form [name=latitude]").val(j.coords.latitude).change();$("#job_submit_form [name=longitude]").val(j.coords.longitude).change()})}});var f=$("#job_submit_form");var d=$(".alert-danger.form-error");var h=f.validate({ignore:"",errorElement:"span",errorClass:"help-block help-block-error",focusInvalid:true,rules:{name:{minlength:3,maxlength:255,required:true},description:{minlength:50,maxlength:4095,required:true},categories:{required:true},url:{minlength:5,remote:{url:$("#job_submit_form").attr("action"),type:"post",data:{check_url:function(){return $("[name=url]",shop_).val()}}}},address:{required:true},longitude:{required:true},latitude:{required:true},tel:{required:true},email:{required:true}},invalidHandler:function(j,i){d.show()},highlight:function(i){$(i).closest(".form-group").removeClass("has-success").addClass("has-error")},unhighlight:function(i){$(i).closest(".form-group").removeClass("has-error")},success:function(i){},errorPlacement:function(i,j){switch($(j).attr("job_name")){default:i.insertAfter(j);break}},submitHandler:function(i){d.hide()}});$("[name='categories[]']",f).select2();f.submit(function(i){if(!f.valid()){i.preventDefault();return false}if(i.originalEvent&&$("#register_form").length==1){$("#register_form").submit();i.preventDefault();return false}$.ajax({url:$(this).attr("action"),type:"POST",data:$(f).serialize(),success:function(j){try{p=JSON.parse(j);switch(p.status){case"success":app.ajaxify(p.params.job_url);break;default:console.log(p);return false;break}}catch(k){console.log(j);return false}},error:function(j){console.log(j);return false}})});if(!navigator.geolocation){var a=$("#company_find_my_position").parents(".input-group");a.before($("input",a));a.remove()}$("#company_geolocation").locationpicker({location:{latitude:33.881967,longitude:9.560764},radius:0,zoom:6,enableAutocomplete:true,scrollwheel:false,inputBinding:{locationNameInput:$("#company_submit_form [name=address]"),latitudeInput:$("#company_submit_form [name=latitude]"),longitudeInput:$("#company_submit_form [name=longitude]")}});$("#company_find_my_position").click(function(i){i.preventDefault();if(navigator.geolocation){navigator.geolocation.getCurrentPosition(function(j){$("#company_submit_form [name=latitude]").val(j.coords.latitude).change();$("#company_submit_form [name=longitude]").val(j.coords.longitude).change()})}});var c=$("#company_submit_form");var d=$(".alert-danger.form-error");var h=c.validate({ignore:"",errorElement:"span",errorClass:"help-block help-block-error",focusInvalid:true,rules:{name:{minlength:3,maxlength:255,required:true},description:{minlength:50,maxlength:4095,required:true},categories:{required:true},url:{minlength:5,remote:{url:$("#company_submit_form").attr("action"),type:"post",data:{check_url:function(){return $("[name=url]",company_).val()}}}},address:{required:true},longitude:{required:true},latitude:{required:true},tel:{required:true},email:{required:true}},invalidHandler:function(j,i){d.show()},highlight:function(i){$(i).closest(".form-group").removeClass("has-success").addClass("has-error")},unhighlight:function(i){$(i).closest(".form-group").removeClass("has-error")},success:function(i){},errorPlacement:function(i,j){switch($(j).attr("company_name")){case"url":i.appendTo($(j.parents(".form-group")[0]).find(".error_msg"));break;default:i.insertAfter(j);break}},submitHandler:function(i){d.hide()}});$("[name='categories[]']",c).select2();c.submit(function(i){if(!c.valid()){i.preventDefault();return false}if(i.originalEvent&&$("#register_form").length==1){$("#register_form").submit();i.preventDefault();return false}$.ajax({url:$(this).attr("action"),type:"POST",data:$(c).serialize(),success:function(j){try{p=JSON.parse(j);switch(p.status){case"success":app.ajaxify(p.params.company_url);break;default:console.log(p);return false;break}}catch(k){console.log(j);return false}},error:function(j){console.log(j);return false}})});if(!navigator.geolocation){var a=$("#shop_find_my_position").parents(".input-group");a.before($("input",a));a.remove()}$("#shop_geolocation").locationpicker({location:{latitude:33.881967,longitude:9.560764},radius:0,zoom:6,enableAutocomplete:true,scrollwheel:false,inputBinding:{locationNameInput:$("#shop_submit_form [name=address]"),latitudeInput:$("#shop_submit_form [name=latitude]"),longitudeInput:$("#shop_submit_form [name=longitude]")}});$("#shop_find_my_position").click(function(i){i.preventDefault();if(navigator.geolocation){navigator.geolocation.getCurrentPosition(function(j){$("#shop_submit_form [name=latitude]").val(j.coords.latitude).change();$("#shop_submit_form [name=longitude]").val(j.coords.longitude).change()})}});var b=$("#shop_submit_form");var d=$(".alert-danger.form-error");var h=b.validate({ignore:"",errorElement:"span",errorClass:"help-block help-block-error",focusInvalid:true,rules:{name:{minlength:3,maxlength:255,required:true},description:{minlength:50,maxlength:4095,required:true},categories:{required:true},url:{minlength:5,remote:{url:$("#shop_submit_form").attr("action"),type:"post",data:{check_url:function(){return $("[name=url]",shop_).val()}}}},address:{required:true},longitude:{required:true},latitude:{required:true},tel:{required:true},email:{required:true}},invalidHandler:function(j,i){d.show()},highlight:function(i){$(i).closest(".form-group").removeClass("has-success").addClass("has-error")},unhighlight:function(i){$(i).closest(".form-group").removeClass("has-error")},success:function(i){},errorPlacement:function(i,j){switch($(j).attr("shop_name")){case"url":i.appendTo($(j.parents(".form-group")[0]).find(".error_msg"));break;default:i.insertAfter(j);break}},submitHandler:function(i){d.hide()}});$("[name='categories[]']",b).select2();b.submit(function(i){if(!b.valid()){i.preventDefault();return false}if(i.originalEvent&&$("#register_form").length==1){$("#register_form").submit();i.preventDefault();return false}$.ajax({url:$(this).attr("action"),type:"POST",data:$(b).serialize(),success:function(j){try{p=JSON.parse(j);switch(p.status){case"success":app.ajaxify(p.params.shop_url);break;default:console.log(p);return false;break}}catch(k){console.log(j);return false}},error:function(j){console.log(j);return false}})});$("#register_form input[name=displayname]").focus()}});