page_script({init:function(){var b=$("#submit_form"),e=$(".alert-danger.form-error",b),f=$(".alert-danger.payment_unhandled_error",b);b.submit(function(a){a.preventDefault()});var d=b.validate({ignore:"",errorElement:"span",errorClass:"help-block help-block-error",focusInvalid:!0,rules:{offer:{required:!0},accept_contract:{required:!0},credit_card_number:{required:!0,creditcard:!0},credit_card_password:{required:!0}},invalidHandler:function(a,c){var b=$(c.currentElements[0]);$("#page_wizard").bootstrapWizard("show",
$(b.parents(".tab-pane")[0]).index());e.show()},highlight:function(a){$(a).closest(".form-group").removeClass("has-success").addClass("has-error")},unhighlight:function(a){$(a).closest(".form-group").removeClass("has-error")},success:function(a){},errorPlacement:function(a,c){switch($(c).attr("name")){case "url":case "accept_contract":a.appendTo($(c.parents(".form-group")[0]).find(".error_msg"));break;default:a.insertAfter(c)}},submitHandler:function(a){e.hide();f.hide()}});b.submit(function(a){a.preventDefault()});
var g=function(){$("#validation .form-control-static",b).each(function(){if("amount"==$(this).attr("data-display"))$("strong",this).html($('[name="offer"]:checked',b).attr("data-amount"));else{var a=$('[name="'+$(this).attr("data-display")+'"]',b);a.is(":radio")&&(a=$('[name="'+$(this).attr("data-display")+'"]:checked',b));a.is("select")?$("strong",this).html(a.find("option:selected").text()):a.is(":radio")&&a.is(":checked")?$("strong",this).html(a.attr("data-title")):$("strong",this).html(a.val())}})};
$("#page_wizard").bootstrapWizard({nextSelector:".button-next",previousSelector:".button-previous",onTabClick:function(a,c,b,d){},onNext:function(a,c,b){e.hide();f.hide()},onPrevious:function(a,c,b){e.hide();f.hide()},onTabShow:function(a,c,b){a=c.find("li").length;a=100*((b+1)/a);$("#page_wizard").find(".progress-bar").css({width:a+"%"});a=c.find("li").length;var d=b+1;$(".step-title",$("#page_wizard")).text("Step "+(b+1)+" of "+a);jQuery("li",$("#page_wizard")).removeClass("done");c=c.find("li");
for(var e=0;e<b;e++)jQuery(c[e]).addClass("done");1==d?$("#page_wizard").find(".button-previous").hide():$("#page_wizard").find(".button-previous").show();d>=a?($("#page_wizard").find(".button-next").hide(),$("#page_wizard").find(".button-submit").show(),g()):($("#page_wizard").find(".button-next").show(),$("#page_wizard").find(".button-submit").hide())}});$("#page_wizard").find(".button-previous").hide();$("#page_wizard .button-submit").click(function(a){if(!b.valid())return!1;$.ajax({url:location.href,
type:"POST",data:$(b).serialize(),success:function(a){try{switch(p=JSON.parse(a),p.status){case "success":p.params.payment_recipt?$("#success_msg .payment_recipt").html(p.params.payment_recipt):$("#success_msg .payment_recipt").parent().hide();$("#success_msg .goto_company").attr("href",p.params.company_url);$("#page_wizard").remove();$("#success_msg").show();break;case "already_done":$("#already_done_msg .payment_recipt").html(p.params.payment_recipt);$("#already_done_msg .goto_company").attr("href",
p.params.company_url);$("#page_wizard").remove();$("#already_done_msg").show();break;case "invalid_card_number":$("#page_wizard").bootstrapWizard("show",2);d.showErrors({credit_card_number:$("[name=credit_card_number]",b).attr("data-msg-error")});break;case "error_card_password":$("#page_wizard").bootstrapWizard("show",2);d.showErrors({credit_card_password:$("[name=credit_card_password]",b).attr("data-msg-error")});break;case "insufficient_balance":$("#page_wizard").bootstrapWizard("show",2);d.showErrors({credit_card_number:$("[name=credit_card_number]",
b).attr("data-msg-balance-error")});break;case "waiting_restriction_time":$("#page_wizard").bootstrapWizard("show",1);d.showErrors({agent_code:p.msg});break;case "code_error":$("#page_wizard").bootstrapWizard("show",1);d.showErrors({agent_code:p.msg});break;case "restricted_host":$("#page_wizard").bootstrapWizard("show",1);d.showErrors({agent_code:p.msg});break;case "unhandled_payment_error":$("#page_wizard").bootstrapWizard("show",2);f.show();break;default:return console.log(p),!1}}catch(e){return console.log(a),
!1}},error:function(a){console.log(a);return!1}})}).hide();$('a[data-toggle="tab"].payment_type').on("shown.bs.tab",function(a){switch($(a.target).attr("href")){case "#local_pay":$(".agent_warning").show();$(".agent_request_success").hide();$("[name=agent_code]").rules("add",{required:!0});$("[name=credit_card_number]").val("");$("[name=credit_card_password]").val("");$("[name=credit_card_number]").rules("remove");$("[name=credit_card_password]").rules("remove");break;case "#pay_online":$("[name=credit_card_number]").rules("add",
{required:!0,creditcard:!0}),$("[name=credit_card_password]").rules("add",{required:!0}),$("[name=agent_code]").val(""),$("[name=agent_code]").rules("remove")}}).trigger("shown.bs.tab");$(".get_agent").click(function(){$.post(location.href,{request_agent:!0},function(a){try{p=JSON.parse(a),p.status="success",$(".agent_warning").hide(),$(".agent_request_success").show()}catch(b){console.log(a)}}).fail(function(a){console.log(a)})})}});
