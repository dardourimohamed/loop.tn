page_script({init:function(){if(!navigator.geolocation){var a=$("#find_my_position").parents(".input-group");a.before($("input",a)),a.remove()}$("#geolocation").locationpicker({location:{latitude:33.881967,longitude:9.560764},radius:0,zoom:6,enableAutocomplete:!0,scrollwheel:!1,inputBinding:{locationNameInput:$("#submit_form [name=address]"),latitudeInput:$("#submit_form [name=latitude]"),longitudeInput:$("#submit_form [name=longitude]")}}),$("#find_my_position").click(function(a){a.preventDefault(),navigator.geolocation&&navigator.geolocation.getCurrentPosition(function(a){$("#submit_form [name=latitude]").val(a.coords.latitude).change(),$("#submit_form [name=longitude]").val(a.coords.longitude).change()})});var b=$("#submit_form"),c=$(".alert-danger.form-error",b),d=$(".alert-danger.payment_unhandled_error",b);b.submit(function(a){a.preventDefault()});var e=b.validate({ignore:"",errorElement:"span",errorClass:"help-block help-block-error",focusInvalid:!0,rules:{name:{minlength:3,maxlength:255,required:!0},description:{minlength:50,maxlength:4095,required:!0},url:{minlength:5,remote:{url:location.href,type:"post",data:{check_url:function(){return $("[name=url]",b).val()}}}},address:{required:!0},longitude:{required:!0},latitude:{required:!0},tel:{required:!0},email:{required:!0},offer:{required:!0},accept_contract:{required:!0},credit_card_number:{required:!0,creditcard:!0},credit_card_password:{required:!0}},invalidHandler:function(a,b){var d=$(b.currentElements[0]);$("#page_wizard").bootstrapWizard("show",$(d.parents(".tab-pane")[0]).index()),c.show(),app.scrollTo(d,-200)},highlight:function(a){$(a).closest(".form-group").removeClass("has-success").addClass("has-error")},unhighlight:function(a){$(a).closest(".form-group").removeClass("has-error")},success:function(){},errorPlacement:function(a,b){switch($(b).attr("name")){case"url":case"accept_contract":a.appendTo($(b.parents(".form-group")[0]).find(".error_msg"));break;default:a.insertAfter(b)}},submitHandler:function(){c.hide(),d.hide()}});b.submit(function(a){a.preventDefault()});var f=function(){$("#validation .form-control-static",b).each(function(){if("amount"==$(this).attr("data-display"))return $("strong",this).html($('[name="offer"]:checked',b).attr("data-amount")),void 0;var a=$('[name="'+$(this).attr("data-display")+'"]',b);a.is(":radio")&&(a=$('[name="'+$(this).attr("data-display")+'"]:checked',b)),a.is("select")?$("strong",this).html(a.find("option:selected").text()):a.is(":radio")&&a.is(":checked")?$("strong",this).html(a.attr("data-title")):$("strong",this).html(a.val())})},g=function(a,b,c){var d=b.find("li").length,e=c+1;$(".step-title",$("#page_wizard")).text("Step "+(c+1)+" of "+d),jQuery("li",$("#page_wizard")).removeClass("done");for(var g=b.find("li"),h=0;c>h;h++)jQuery(g[h]).addClass("done");1==e?$("#page_wizard").find(".button-previous").hide():$("#page_wizard").find(".button-previous").show(),e>=d?($("#page_wizard").find(".button-next").hide(),$("#page_wizard").find(".button-submit").show(),f()):($("#page_wizard").find(".button-next").show(),$("#page_wizard").find(".button-submit").hide()),app.scrollTo($(".page-title"))};$("#page_wizard").bootstrapWizard({nextSelector:".button-next",previousSelector:".button-previous",onTabClick:function(){return!1},onNext:function(){c.hide(),d.hide()},onPrevious:function(){c.hide(),d.hide()},onTabShow:function(a,b,c){var d=b.find("li").length,e=c+1,f=100*(e/d);$("#page_wizard").find(".progress-bar").css({width:f+"%"}),g(a,b,c)}}),$("#page_wizard").find(".button-previous").hide(),$("#page_wizard .button-submit").click(function(){return b.valid()?(console.log(b),console.log(new FormData(b)),app.blockUI({iconOnly:!0,animate:!0}),$.ajax({url:location.href,type:"POST",data:$(b).serialize(),success:function(a){app.unblockUI();try{switch(p=JSON.parse(a),p.status){case"success":$("#success_msg .payment_recipt").html(p.params.payment_recipt),$("#success_msg .goto_company").attr("href",p.params.company_url),$("#page_wizard").remove(),$("#success_msg").show();break;case"already_done":$("#already_done_msg .payment_recipt").html(p.params.payment_recipt),$("#already_done_msg .goto_company").attr("href",p.params.company_url),$("#page_wizard").remove(),$("#already_done_msg").show();break;case"invalid_card_number":$("#page_wizard").bootstrapWizard("show",2),e.showErrors({credit_card_number:$("[name=credit_card_number]",b).attr("data-msg-error")});break;case"error_card_password":$("#page_wizard").bootstrapWizard("show",2),e.showErrors({credit_card_password:$("[name=credit_card_password]",b).attr("data-msg-error")});break;case"insufficient_balance":$("#page_wizard").bootstrapWizard("show",2),e.showErrors({credit_card_number:$("[name=credit_card_number]",b).attr("data-msg-balance-error")});break;case"unhandled_payment_error":$("#page_wizard").bootstrapWizard("show",2),d.show();break;default:return console.log(p),!1}}catch(c){return console.log(a),!1}},error:function(a){return app.unblockUI(),console.log(a),!1}}),void 0):!1}).hide(),$("[name=name]",b).focus()}});