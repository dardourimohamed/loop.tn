page_script({init:function(){var a=$("#submit_form"),b=$(".alert-danger.form-error",a),c=$(".alert-danger.payment_unhandled_error",a);a.submit(function(a){a.preventDefault()});var d=a.validate({ignore:"",errorElement:"span",errorClass:"help-block help-block-error",focusInvalid:!0,rules:{offer:{required:!0},accept_contract:{required:!0},credit_card_number:{required:!0,creditcard:!0},credit_card_password:{required:!0}},invalidHandler:function(a,c){var d=$(c.currentElements[0]);$("#page_wizard").bootstrapWizard("show",$(d.parents(".tab-pane")[0]).index()),b.show(),app.scrollTo(d,-200)},highlight:function(a){$(a).closest(".form-group").removeClass("has-success").addClass("has-error")},unhighlight:function(a){$(a).closest(".form-group").removeClass("has-error")},success:function(){},errorPlacement:function(a,b){switch($(b).attr("name")){case"accept_contract":a.appendTo($(b.parents(".form-group")[0]).find(".error_msg"));break;default:a.insertAfter(b)}},submitHandler:function(){b.hide(),c.hide()}});a.submit(function(a){a.preventDefault()});var e=function(){$("#validation .form-control-static",a).each(function(){if("amount"==$(this).attr("data-display"))return $("strong",this).html($('[name="offer"]:checked',a).attr("data-amount")),void 0;var b=$('[name="'+$(this).attr("data-display")+'"]',a);b.is(":radio")&&(b=$('[name="'+$(this).attr("data-display")+'"]:checked',a)),b.is("select")?$("strong",this).html(b.find("option:selected").text()):b.is(":radio")&&b.is(":checked")?$("strong",this).html(b.attr("data-title")):$("strong",this).html(b.val())})},f=function(a,b,c){var d=b.find("li").length,f=c+1;$(".step-title",$("#page_wizard")).text("Step "+(c+1)+" of "+d),jQuery("li",$("#page_wizard")).removeClass("done");for(var g=b.find("li"),h=0;c>h;h++)jQuery(g[h]).addClass("done");1==f?$("#page_wizard").find(".button-previous").hide():$("#page_wizard").find(".button-previous").show(),f>=d?($("#page_wizard").find(".button-next").hide(),$("#page_wizard").find(".button-submit").show(),e()):($("#page_wizard").find(".button-next").show(),$("#page_wizard").find(".button-submit").hide()),app.scrollTo($(".page-title"))};$("#page_wizard").bootstrapWizard({nextSelector:".button-next",previousSelector:".button-previous",onTabClick:function(){},onNext:function(){b.hide(),c.hide()},onPrevious:function(){b.hide(),c.hide()},onTabShow:function(a,b,c){var d=b.find("li").length,e=c+1,g=100*(e/d);$("#page_wizard").find(".progress-bar").css({width:g+"%"}),f(a,b,c)}}),$("#page_wizard").find(".button-previous").hide(),$("#page_wizard .button-submit").click(function(){return a.valid()?(app.blockUI({iconOnly:!0,animate:!0}),$.ajax({url:location.href,type:"POST",data:$(a).serialize(),success:function(b){app.unblockUI();try{switch(p=JSON.parse(b),p.status){case"success":p.params.payment_recipt?$("#success_msg .payment_recipt").html(p.params.payment_recipt):$("#success_msg .payment_recipt").parent().hide(),$("#success_msg .goto_job").attr("href",p.params.job_url),$("#page_wizard").remove(),$("#success_msg").show();break;case"already_done":$("#already_done_msg .payment_recipt").html(p.params.payment_recipt),$("#already_done_msg .goto_job").attr("href",p.params.job_url),$("#page_wizard").remove(),$("#already_done_msg").show();break;case"invalid_card_number":$("#page_wizard").bootstrapWizard("show",1),d.showErrors({credit_card_number:$("[name=credit_card_number]",a).attr("data-msg-error")});break;case"error_card_password":$("#page_wizard").bootstrapWizard("show",1),d.showErrors({credit_card_password:$("[name=credit_card_password]",a).attr("data-msg-error")});break;case"insufficient_balance":$("#page_wizard").bootstrapWizard("show",1),d.showErrors({credit_card_number:$("[name=credit_card_number]",a).attr("data-msg-balance-error")});break;case"waiting_restriction_time":$("#page_wizard").bootstrapWizard("show",1),d.showErrors({agent_code:p.msg});break;case"code_error":$("#page_wizard").bootstrapWizard("show",1),d.showErrors({agent_code:p.msg});break;case"restricted_host":$("#page_wizard").bootstrapWizard("show",1),d.showErrors({agent_code:p.msg});break;case"unhandled_payment_error":$("#page_wizard").bootstrapWizard("show",1),c.show();break;default:return console.log(p),!1}}catch(e){return console.log(b),!1}},error:function(a){return app.unblockUI(),console.log(a),!1}}),void 0):!1}).hide(),$('a[data-toggle="tab"].payment_type').on("shown.bs.tab",function(a){var b=$(a.target).attr("href");switch(b){case"#local_pay":$(".agent_warning").show(),$(".agent_request_success").hide(),$("[name=agent_code]").rules("add",{required:!0}),$("[name=credit_card_number]").val(""),$("[name=credit_card_password]").val(""),$("[name=credit_card_number]").rules("remove"),$("[name=credit_card_password]").rules("remove");break;case"#pay_online":$("[name=credit_card_number]").rules("add",{required:!0,creditcard:!0}),$("[name=credit_card_password]").rules("add",{required:!0}),$("[name=agent_code]").val(""),$("[name=agent_code]").rules("remove")}}).trigger("shown.bs.tab"),$(".get_agent").click(function(){$.post(location.href,{request_agent:!0},function(a){try{p=JSON.parse(a),(p.status="success")?($(".agent_warning").hide(),$(".agent_request_success").show()):console.log(a)}catch(b){console.log(a)}}).fail(function(a){console.log(a)})})}});