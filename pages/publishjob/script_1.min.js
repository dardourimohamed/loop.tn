page_script({init:function(){var d=$("#submit_form");var b=$(".alert-danger.form-error",d);var a=$(".alert-danger.payment_unhandled_error",d);d.submit(function(g){g.preventDefault()});var f=d.validate({ignore:"",errorElement:"span",errorClass:"help-block help-block-error",focusInvalid:true,rules:{offer:{required:true},accept_contract:{required:true},credit_card_number:{required:true,creditcard:true},credit_card_password:{required:true}},invalidHandler:function(i,g){var h=$(g.currentElements[0]);$("#page_wizard").bootstrapWizard("show",$(h.parents(".tab-pane")[0]).index());b.show()},highlight:function(g){$(g).closest(".form-group").removeClass("has-success").addClass("has-error")},unhighlight:function(g){$(g).closest(".form-group").removeClass("has-error")},success:function(g){},errorPlacement:function(g,h){switch($(h).attr("name")){case"accept_contract":g.appendTo($(h.parents(".form-group")[0]).find(".error_msg"));break;default:g.insertAfter(h);break}},submitHandler:function(g){b.hide();a.hide()}});d.submit(function(g){g.preventDefault()});var e=function(){$("#validation .form-control-static",d).each(function(){if($(this).attr("data-display")=="amount"){$("strong",this).html($('[name="offer"]:checked',d).attr("data-amount"));return}var g=$('[name="'+$(this).attr("data-display")+'"]',d);if(g.is(":radio")){g=$('[name="'+$(this).attr("data-display")+'"]:checked',d)}if(g.is("select")){$("strong",this).html(g.find("option:selected").text())}else{if(g.is(":radio")&&g.is(":checked")){$("strong",this).html(g.attr("data-title"))}else{$("strong",this).html(g.val())}}})};var c=function(k,g,h){var l=g.find("li").length;var m=h+1;$(".step-title",$("#page_wizard")).text("Step "+(h+1)+" of "+l);jQuery("li",$("#page_wizard")).removeClass("done");var n=g.find("li");for(var j=0;j<h;j++){jQuery(n[j]).addClass("done")}if(m==1){$("#page_wizard").find(".button-previous").hide()}else{$("#page_wizard").find(".button-previous").show()}if(m>=l){$("#page_wizard").find(".button-next").hide();$("#page_wizard").find(".button-submit").show();e()}else{$("#page_wizard").find(".button-next").show();$("#page_wizard").find(".button-submit").hide()}};$("#page_wizard").bootstrapWizard({nextSelector:".button-next",previousSelector:".button-previous",onTabClick:function(i,g,h,j){},onNext:function(i,g,h){b.hide();a.hide()},onPrevious:function(i,g,h){b.hide();a.hide()},onTabShow:function(j,g,i){var k=g.find("li").length;var l=i+1;var h=(l/k)*100;$("#page_wizard").find(".progress-bar").css({width:h+"%"});c(j,g,i)}});$("#page_wizard").find(".button-previous").hide();$("#page_wizard .button-submit").click(function(g){if(!d.valid()){return false}$.ajax({url:location.href,type:"POST",data:$(d).serialize(),success:function(h){try{p=JSON.parse(h);switch(p.status){case"success":if(p.params.payment_recipt){$("#success_msg .payment_recipt").html(p.params.payment_recipt)}else{$("#success_msg .payment_recipt").parent().hide()}$("#success_msg .goto_job").attr("href",p.params.job_url);$("#page_wizard").remove();$("#success_msg").show();break;case"already_done":$("#already_done_msg .payment_recipt").html(p.params.payment_recipt);$("#already_done_msg .goto_job").attr("href",p.params.job_url);$("#page_wizard").remove();$("#already_done_msg").show();break;case"invalid_card_number":$("#page_wizard").bootstrapWizard("show",1);f.showErrors({credit_card_number:$("[name=credit_card_number]",d).attr("data-msg-error")});break;case"error_card_password":$("#page_wizard").bootstrapWizard("show",1);f.showErrors({credit_card_password:$("[name=credit_card_password]",d).attr("data-msg-error")});break;case"insufficient_balance":$("#page_wizard").bootstrapWizard("show",1);f.showErrors({credit_card_number:$("[name=credit_card_number]",d).attr("data-msg-balance-error")});break;case"waiting_restriction_time":$("#page_wizard").bootstrapWizard("show",1);f.showErrors({agent_code:p.msg});break;case"code_error":$("#page_wizard").bootstrapWizard("show",1);f.showErrors({agent_code:p.msg});break;case"restricted_host":$("#page_wizard").bootstrapWizard("show",1);f.showErrors({agent_code:p.msg});break;case"unhandled_payment_error":$("#page_wizard").bootstrapWizard("show",1);a.show();break;default:console.log(p);return false;break}}catch(i){console.log(h);return false}},error:function(h){console.log(h);return false}})}).hide();$('a[data-toggle="tab"].payment_type').on("shown.bs.tab",function(h){var g=$(h.target).attr("href");switch(g){case"#local_pay":$(".agent_warning").show();$(".agent_request_success").hide();$("[name=agent_code]").rules("add",{required:true});$("[name=credit_card_number]").val("");$("[name=credit_card_password]").val("");$("[name=credit_card_number]").rules("remove");$("[name=credit_card_password]").rules("remove");break;case"#pay_online":$("[name=credit_card_number]").rules("add",{required:true,creditcard:true});$("[name=credit_card_password]").rules("add",{required:true});$("[name=agent_code]").val("");$("[name=agent_code]").rules("remove");break}}).trigger("shown.bs.tab");$(".get_agent").click(function(){$.post(location.href,{request_agent:true},function(g){try{p=JSON.parse(g);if(p.status="success"){$(".agent_warning").hide();$(".agent_request_success").show()}else{console.log(g)}}catch(h){console.log(g)}}).fail(function(g){console.log(g)})})}});