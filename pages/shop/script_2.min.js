page_script({init:function(){$.fn.editable.defaults.ajaxOptions={type:"POST"};$.fn.editable.defaults.type="text";$.fn.editable.defaults.pk=1;$.fn.editable.defaults.mode="inline";$.fn.editable.defaults.inputclass="form-control";$.fn.editable.defaults.url=location.href;$.fn.editable.defaults.onblur="submit";$.fn.editable.defaults.emptytext="Vide";$(".editable").editable({params:function(k){k.element="shop";return k}});if($(".categories-editable").length>0){$(".categories-editable").editable({mode:"popup",inputclass:"input-medium",params:function(k){k.element="shop";return k},select2:{multiple:true},source:JSON.parse($(".categories-editable").attr("data-available"))})}$(".seat_editable").editable({params:function(k){k.element="seat";return k}});$(".product_editable").editable({mode:"popup",params:function(k){k.element="product";return k}});var c=[];var i=function(m){var l=JSON.parse($("input[name=available_product_categories]").val());Array.prototype.push.apply(l,c);if(m){for(var k=0;k<l.length;k++){if(l.hasOwnProperty(k)&&l[k].text.indexOf(m)==-1){l.splice(k,1);if(k||l.length){k--}}}}return l};$(".product_categories_editable").editable({mode:"popup",autotext:"always",params:function(k){k.element="product";return k},source:i(),display:function(n,m){console.log(n);var k=[],l=$.fn.editableutils.itemsByValue(n,i(),"id");if(l.length){$.each(l,function(p,o){k.push($.fn.editableutils.escape(o.text))});$(this).html(k.join(", "))}else{$(this).empty()}},select2:{multiple:true,query:function(k){k.callback({results:i(k.term)})}}});$(".new_product").click(function(k){$.ajax({url:location.href,type:"POST",data:{new_product:true},success:function(l){try{var o=JSON.parse(l);switch(o.status){case"success":var n=$("#new_product_template").clone();n.removeAttr("id");n.prependTo("#products_list").show();n.attr("data-id",o.id);$(".product_editable",n).attr("data-pk",o.id).editable({value:null,mode:"popup",params:function(q){q.element="product";return q}});$(".product_categories_editable",n).attr("data-pk",o.id).editable({value:[],mode:"popup",params:function(q){q.element="product";return q},source:JSON.parse($("input[name=available_product_categories]").val()),select2:{multiple:true}});$(".delete",n).click(function(p){j(p,this)});$("input[type=file]",n).change(function(p){h(p,this)});$(".price_checkbox",n).change(g);$(".rent_price_checkbox",n).change(b);$(".fb-like",n).attr("data-href",o.url);$("[href='#products_list']").click();$($(".thumbnail",n)[0]).pulsate({color:"#399bc3",repeat:2});break;default:console.log(l);break}}catch(m){console.log(l)}},error:function(l){console.log(l)}})});var g=function(n){var k=$(this).parents("p");var l=$("[data-name=price]",k);var m=$(".unit",k);if($(this).prop("checked")){l.editable("enable");m.show()}else{$.post(location.href,{element:"product",pk:l.attr("data-pk"),name:"price",value:null},function(o){l.editable("setValue",null).editable("submit").editable("disable");m.hide()})}};var b=function(n){var k=$(this).parents("p");var l=$("[data-name=rent_price]",k);var m=$(".unit",k);if($(this).prop("checked")){l.editable("enable");m.show()}else{$.post(location.href,{element:"product",pk:l.attr("data-pk"),name:"rent_price",value:null},function(o){l.editable("setValue",null).editable("submit").editable("disable");m.hide()})}};$(".price_checkbox").change(g);$(".rent_price_checkbox").change(b);var j=function(m,l){m.preventDefault();var k=$(l).parents(".product");$.ajax({url:location.href,type:"POST",data:{delete_product:k.attr("data-id")},success:function(n){try{var q=JSON.parse(n);switch(q.status){case"success":k.remove();break;default:console.log(n);break}}catch(o){console.log(n)}},error:function(n){console.log(n)}})};$(".product .delete").click(function(k){j(k,this)});var h=function(n,k){if(k.files.length==0){return}var m=$(".product form");var l=new FormData(m[0]);l.append("file","product_image");l.append("pk",$(k).parents(".product").attr("data-id"));$.ajax({url:location.href,type:"POST",data:l,enctype:"multipart/form-data",processData:false,contentType:false,success:function(o){if(o!="success"){console.log(o)}},error:function(o){console.log(o)}})};$(".product input[type=file]").change(function(k){h(k,this)});$(".image input[type=file]").change(function(m){if(this.files.length==0){return}var l=$(".image form");var k=new FormData(l[0]);k.append("file","image");$.ajax({url:location.href,type:"POST",data:k,enctype:"multipart/form-data",processData:false,contentType:false,success:function(n){if(n!="success"){console.log(n)}},error:function(n){console.log(n)}})});$(".cover input[type=file]").change(function(m){if(this.files.length==0){return}var l=$(".cover form");var k=new FormData(l[0]);k.append("file","cover");$.ajax({url:location.href,type:"POST",data:k,enctype:"multipart/form-data",processData:false,contentType:false,success:function(n){if(n!="success"){console.log(n)}},error:function(n){console.log(n)}})});var a=$(".map_container .map-canvas");var e=new google.maps.LatLng(a.attr("data-latitude"),a.attr("data-longitude"));var d={scrollwheel:false,zoom:13,center:e};var a=new google.maps.Map(a[0],d);var f=new google.maps.Marker({position:e});f.setMap(a);$("#map_modal").on("shown.bs.modal",function(k){$("#map_modal .map-canvas").each(function(){$(this).locationpicker({location:{latitude:$(this).attr("data-latitude"),longitude:$(this).attr("data-longitude")},radius:0,zoom:12,enableAutocomplete:true,scrollwheel:true,onchanged:function(n,l,m){$.ajax({url:location.href,type:"POST",data:{geolocation:$(this).attr("data-pk"),latitude:n.latitude,longitude:n.longitude},success:function(q){try{if(q=="success"){$(".map-canvas").attr("data-latitude",n.latitude);$(".map-canvas").attr("data-longitude",n.longitude);var t=$(".map_container .map-canvas");var p=new google.maps.LatLng(t.attr("data-latitude"),t.attr("data-longitude"));var r={scrollwheel:false,zoom:13,center:p};var t=new google.maps.Map(t[0],r);var o=new google.maps.Marker({position:p});o.setMap(t)}else{console.log(q)}}catch(s){console.log(q)}},error:function(o){console.log(o)}})}})})});$(".transform_job").click(function(){if(!confirm("Etes vous sûr ?")){return false}$.post(location.href,{transform:"job"},function(k){try{if(k=="success"){app.ajaxify(location.href)}else{console.log(k)}}catch(l){console.log(k)}})});$(".transform_company").click(function(){if(!confirm("Etes vous sûr ?")){return false}$.post(location.href,{transform:"company"},function(k){try{if(k=="success"){app.ajaxify(location.href)}else{console.log(k)}}catch(l){console.log(k)}})});$(".delete_page").click(function(){if(!confirm($(this).attr("data-confirm")+$('.profile-usertitle-name a[data-name="name"]').text())){return false}$.post(location.href,{remove_me:true},function(k){try{if(k=="success"){app.ajaxify("/account")}else{console.log(k)}}catch(l){console.log(k)}})});if($(".messages .badge").length){$(".messages").pulsate({color:"#e91e63",repeat:3})}$(".ticket .cancel_password_reset_ticket").click(function(k){$.post(location.href,{cancel_password_reset_ticket:true},function(l){try{var m=JSON.parse(l);if(m.status=="success"){$(".ticket").hide();$(".new_ticket").show();$(".ticket .token").text("")}else{console.log(l)}}catch(n){console.log(l)}})});$(".new_ticket .new_password_reset_ticket").click(function(k){$.post(location.href,{new_password_reset_ticket:true},function(l){try{var m=JSON.parse(l);if(m.status=="success"){$(".ticket .token").text(m.params.token);$(".new_ticket").hide();$(".ticket").show()}else{console.log(l)}}catch(n){console.log(l)}})});$("#add_category_form").ajaxForm({success:function(k){try{parsed=JSON.parse(k);if(parsed.status=="success"){c.push({id:parsed.params.id,text:parsed.params.text});$("#add_category_modal").modal("hide")}else{console.log(k)}}catch(l){console.log(k)}}});$("#add_category_form").on("hide.bs.modal",function(){$("#add_category_form")[0].reset()});$(".clear_value").live("click",function(){$($(this).parent()[0]).children('[data-name="categories"]').editable("setValue",[])})}});